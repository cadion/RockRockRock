(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();function se(){const e=["blue","yellow","orange","purple","white"],s=["rock","paper","scissors"],n=[];for(const i of e)for(const o of s)n.push({color:i,shape:o,id:`${i}-${o}-${Date.now()}-${Math.random()}`});return $(n)}function $(e){const s=[...e];for(let n=s.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[s[n],s[i]]=[s[i],s[n]]}return s}const t={round:1,deck:[],hand:[],discardPile:[],passives:[],currentGimmick:null,currentBoss:null,currentBossHealth:0,maxBossHealth:0,bossTurnCount:0,deckSize:15,previousShapes:[],enemyCards:[],playerCards:[],selectedHandIndices:[],lostCardsThisRound:0,consecutiveWins:0,lastWinColors:[],phase:"battle",nextRoundModifier:null,reset(){this.round=1,this.deck=se(),this.hand=[],this.discardPile=[],this.passives=[],this.currentGimmick=null,this.currentBoss=null,this.currentBossHealth=0,this.maxBossHealth=0,this.bossTurnCount=0,this.deckSize=15,this.previousShapes=[],this.enemyCards=[],this.playerCards=[],this.selectedHandIndices=[],this.lostCardsThisRound=0,this.consecutiveWins=0,this.lastWinColors=[],this.phase="battle",this.nextRoundModifier=null}},k={bigHand:{id:"bigHand",name:"í° ì†",icon:"ğŸ–ï¸",desc:"í•¸ë“œ í¬ê¸°ê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤ (6ì¥)",color:"#27ae60",tier:1,handSizeBonus:1},smallDeck:{id:"smallDeck",name:"ì••ì¶•",icon:"ğŸ“¦",desc:"ë± í¬ê¸°ê°€ 2 ê°ì†Œí•©ë‹ˆë‹¤",color:"#e67e22",tier:1,onApply:e=>{e.deckSize-=2},onRemove:e=>{e.deckSize+=2}},whiteStabilize:{id:"whiteStabilize",name:"ë°±ìƒ‰ ì•ˆì •",icon:"âšª",desc:"í°ìƒ‰ ì¹´ë“œëŠ” ì†Œë©¸ ì‹œ ë±ìœ¼ë¡œ ë³µê·€í•©ë‹ˆë‹¤",color:"#ecf0f1",tier:1},earlyBird:{id:"earlyBird",name:"ê¸°ì„  ì œì••",icon:"ğŸ¦",desc:"ì²« ë²ˆì§¸ ì¹´ë“œê°€ ë¹„ê¸¸ ê²½ìš° ìŠ¹ë¦¬ë¡œ ê°„ì£¼",color:"#f39c12",tier:1},shield:{id:"shield",name:"ë°©íŒ¨",icon:"ğŸ›¡ï¸",desc:"ì „íˆ¬ íŒ¨ë°° ì‹œ ìƒëŠ” ì¹´ë“œ ìˆ˜ -1 (ìµœì†Œ 1)",color:"#7f8c8d",tier:1},deckSizer:{id:"deckSizer",name:"ì ì • ê¸°ìˆ ",icon:"ğŸ“",desc:"ë± í¬ê¸°ê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤",color:"#16a085",tier:1,onApply:e=>{e.deckSize+=1},onRemove:e=>{e.deckSize-=1}},redMatch:{id:"redMatch",name:"ë¶‰ì€ ì‹¬íŒ",icon:"ğŸ”´",desc:"ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#e74c3c",tier:2},blueMatch:{id:"blueMatch",name:"í‘¸ë¥¸ ì‹¬íŒ",icon:"ğŸ”µ",desc:"íŒŒë€ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#3498db",tier:2},redRush:{id:"redRush",name:"ë¹¨ê°„ ë§›",icon:"ğŸ",desc:"í•„ë“œì— ë¹¨ê°„ìƒ‰ ì¹´ë“œê°€ 3ì¥ ì´ìƒì´ë©´ ìŠ¹ì  +1",color:"#c0392b",tier:2},flexibility:{id:"flexibility",name:"ìœ ì—°í•¨",icon:"ğŸŒŠ",desc:"ë³´ë¡œ ì´ê¸°ë©´ ë²„ë ¤ì§„ ì¹´ë“œ 1ì¥ ë³µêµ¬",color:"#2980b9",tier:2},recycle:{id:"recycle",name:"ì¬í™œìš©",icon:"â™»ï¸",desc:"ë²„ë ¤ì§ˆ í°ìƒ‰ ì¹´ë“œ 1ì¥ì€ ë±ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤",color:"#95a5a6",tier:2},blueShield:{id:"blueShield",name:"í‘¸ë¥¸ ë°©ë²½",icon:"ğŸ’™",desc:"í•„ë“œì— íŒŒë€ìƒ‰ 2ì¥ ì´ìƒ ì‹œ íŒ¨ë°° íŒ¨ë„í‹° -1",color:"#3498db",tier:2},greenGrowth:{id:"greenGrowth",name:"ì´ˆë¡ ì„±ì¥",icon:"ğŸŒ±",desc:"ì´ˆë¡ìƒ‰ ì¹´ë“œë¡œ ìŠ¹ë¦¬ ì‹œ ê°™ì€ ëª¨ì–‘ ì¹´ë“œ 1ì¥ íšë“",color:"#27ae60",tier:2},yellowFlash:{id:"yellowFlash",name:"í™©ê¸ˆ ë¹›",icon:"âœ¨",desc:"ë…¸ë€ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#f1c40f",tier:2},colorCollector:{id:"colorCollector",name:"ìƒ‰ì±„ ìˆ˜ì§‘ê°€",icon:"ğŸ¨",desc:"í•„ë“œì— 3ê°€ì§€ ìƒ‰ìƒ ì´ìƒ ë°°ì¹˜ ì‹œ ìŠ¹ì  +1",color:"#9b59b6",tier:2},thirdReverse:{id:"thirdReverse",name:"ì—­ì „ì˜ ìš©ì‚¬",icon:"ğŸ”„",desc:"ì„¸ ë²ˆì§¸ ì¹´ë“œëŠ” ì§€ëŠ” ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#9b59b6",tier:3},joker:{id:"joker",name:"ì¡°ì»¤",icon:"ğŸƒ",desc:"ë³´ë¼ìƒ‰ ì¹´ë“œëŠ” ë¬´ì¡°ê±´ ìŠ¹ë¦¬ (ëª¨ì–‘ ë¬´ì‹œ)",color:"#8e44ad",tier:3},monochrome:{id:"monochrome",name:"ë‹¨ìƒ‰í™”",icon:"â¬›",desc:"ë±ì— ìƒ‰ìƒì´ 2ì¢…ë¥˜ ì´í•˜ë¼ë©´ ë¹„ê¸°ëŠ” ìƒí™©ì—ì„œ ìŠ¹ë¦¬",color:"#34495e",tier:3},perfectCycle:{id:"perfectCycle",name:"ì™„ë²½í•œ ìˆœí™˜",icon:"ğŸ”",desc:"ë±ì˜ ê°€ìœ„,ë°”ìœ„,ë³´ ë¹„ìœ¨ì´ ë™ì¼í•˜ë©´ í•¸ë“œ +1",color:"#1abc9c",tier:3,handSizeBonus:0},lastStand:{id:"lastStand",name:"ìµœí›„ì˜ ì¼ê²©",icon:"âš¡",desc:"ë§ˆì§€ë§‰ ìŠ¬ë¡¯ì˜ ì¹´ë“œê°€ ë°”ìœ„ë¼ë©´ ë¬´ì¡°ê±´ ìŠ¹ë¦¬",color:"#e67e22",tier:3},rainbowMaster:{id:"rainbowMaster",name:"ë¬´ì§€ê°œ ì§€ë°°ì",icon:"ğŸŒˆ",desc:"í•„ë“œì— 5ìƒ‰ì´ ëª¨ë‘ ëª¨ì´ë©´ ë¼ìš´ë“œ ì¦‰ì‹œ ìŠ¹ë¦¬",color:"#e74c3c",tier:3}},y={twoCards:{id:"twoCards",name:"ê°€ë²¼ìš´ ì „íˆ¬",desc:"ì ì´ íŒ¨ë¥¼ 2ê°œë§Œ ëƒ…ë‹ˆë‹¤",tier:1,enemyCardCount:2},greenOnly:{id:"greenOnly",name:"ì´ˆë¡ ì „ì—¼ë³‘",desc:"ì ì´ ì´ˆë¡ìƒ‰ íŒ¨ë§Œ ëƒ…ë‹ˆë‹¤",tier:1,enemyColor:"green"},scissorsOnly:{id:"scissorsOnly",name:"ê°€ìœ„ ë°”ëŒ",desc:"ì ì´ ê°€ìœ„ë§Œ ëƒ…ë‹ˆë‹¤",tier:1,enemyShape:"scissors"},fog:{id:"fog",name:"ì•ˆê°œ",desc:"ì ì˜ ê°€ìš´ë° íŒ¨ê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:1,hiddenIndex:1},static:{id:"static",name:"ì •ì „ê¸°",desc:"í•„ë“œì— ë†“ì€ ì¹´ë“œë¥¼ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",tier:1,cannotDeselect:!0},haste:{id:"haste",name:"ì‹ ì†",desc:"ì œì¶œ ì „ê¹Œì§€ ì ì˜ ì¹´ë“œê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:1,hideAllEnemyCards:!0},heavy:{id:"heavy",name:"ë¬´ê±°ìš´ ì§",desc:"í•¸ë“œ ë“œë¡œìš° ì‹œ 1ì¥ì„ ëœ ë½‘ìŠµë‹ˆë‹¤",tier:1,drawPenalty:1},fourCards:{id:"fourCards",name:"4ì—°íƒ€",desc:"ì ì´ íŒ¨ë¥¼ 4ê°œ ëƒ…ë‹ˆë‹¤",tier:2,enemyCardCount:4},mimic:{id:"mimic",name:"ëª¨ë°©",desc:"ì ì˜ ì²« ë²ˆì§¸ íŒ¨ê°€ ë‹¹ì‹ ì˜ ì„ íƒì„ ë”°ë¼í•©ë‹ˆë‹¤",tier:2,mimicFirst:!0},corrosion:{id:"corrosion",name:"ë¶€ì‹",desc:"ì´ë²ˆ ë¼ìš´ë“œ, ë°”ìœ„ëŠ” ê°€ìœ„ì—ê²Œ ì§‘ë‹ˆë‹¤",tier:2,rockLosesToScissors:!0},reversal:{id:"reversal",name:"ì—­ì „ì˜ ëŒ€ê°€",desc:"í•¸ë“œ ì¹´ë“œëŠ” ë±ìœ¼ë¡œ, í•„ë“œ ì¹´ë“œëŠ” ì†Œë©¸í•©ë‹ˆë‹¤",tier:2,reversedDiscard:!0},purpleAcquire:{id:"purpleAcquire",name:"ë³´ë¼ìƒ‰í­í’",desc:"ì¹´ë“œ íšë“ ì‹œ ë³´ë¼ìƒ‰ë§Œ ë“±ì¥í•©ë‹ˆë‹¤",tier:2,acquireColor:"purple"},scissorsAcquire:{id:"scissorsAcquire",name:"ê°€ìœ„ ì„¸ë¡€",desc:"ì¹´ë“œ íšë“ ì‹œ ê°€ìœ„ë§Œ ë“±ì¥í•©ë‹ˆë‹¤",tier:2,acquireShape:"scissors"},gravity:{id:"gravity",name:"ì¤‘ë ¥",desc:"íŠ¹ì • ìƒ‰ìƒì˜ ì¹´ë“œë¥¼ ì´ë²ˆ ë¼ìš´ë“œì— ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",tier:2,bannedColor:null},chaosAcquire:{id:"chaosAcquire",name:"í˜¼ëˆì˜ íšë“",desc:"ì¹´ë“œ íšë“ ì‹œ ì„ íƒì§€ ì—†ì´ ë¬´ì‘ìœ„ íšë“",tier:2,randomAcquire:!0},blindSide:{id:"blindSide",name:"ì‚¬ê°ì§€ëŒ€",desc:"í™€ìˆ˜ ë²ˆì§¸ ì ì˜ ì¹´ë“œê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:2,hideOddCards:!0},overload:{id:"overload",name:"í­ì£¼",desc:"ì ì´ íŒ¨ë¥¼ 5ê°œ ëƒ…ë‹ˆë‹¤! (í•¸ë“œ ì „ë¶€ ì‚¬ìš©)",tier:3,enemyCardCount:5},passiveNull:{id:"passiveNull",name:"ì¹¨ë¬µ",desc:"ëª¨ë“  íŒ¨ì‹œë¸Œ íš¨ê³¼ê°€ ì´ë²ˆ ë¼ìš´ë“œì— ë°œë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:3,disablePassives:!0},colorCurse:{id:"colorCurse",name:"ìƒ‰ìƒ ì €ì£¼",desc:"íŠ¹ì • ìƒ‰ìƒ ì¹´ë“œë¡œ íŒ¨ë°° ì‹œ í•´ë‹¹ ì¹´ë“œ ì˜êµ¬ ì‚­ì œ",tier:3,cursedColor:null},echo:{id:"echo",name:"ë©”ì•„ë¦¬",desc:"ì ì´ í”Œë ˆì´ì–´ì˜ ì§€ë‚œ ë¼ìš´ë“œ ëª¨ì–‘ì„ ê·¸ëŒ€ë¡œ ëƒ…ë‹ˆë‹¤",tier:3,usePreviousShapes:!0},dimensionShift:{id:"dimensionShift",name:"ì°¨ì› ì „ì´",desc:"ìƒì„± ê´€ê³„ê°€ ë°˜ëŒ€ë¡œ ë°”ë€ë‹ˆë‹¤ (ë³´ > ê°€ìœ„ > ë°”ìœ„ > ë³´)",tier:3,reverseRPS:!0}},b={guardian:{id:"guardian",name:"ìˆ˜í˜¸ì",desc:"6ì¥ì˜ ì¹´ë“œë¡œ ë‹¹ì‹ ì„ ì••ë°•í•©ë‹ˆë‹¤. 5í„´ ì´ë‚´ì— ì œì••í•˜ì§€ ëª»í•˜ë©´ íŒ¨ë°°í•©ë‹ˆë‹¤.",cardCount:6,hp:15,maxTurns:5,playerHandBonus:1,bgColor:"#1a0a0a",reward:"rare_passive"},chaos:{id:"chaos",name:"í˜¼ëˆì˜ êµ°ì£¼",desc:"ì±„ë ¥ì´ ë–¨ì–´ì§ˆìˆ˜ë¡ ì·¨ê¸‰í•˜ëŠ” ì¹´ë“œê°€ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.",baseCardCount:5,hp:20,dynamicCards:!0,bgColor:"#0a0a1a",reward:"deck_purge"},mirror:{id:"mirror",name:"ê±°ìš¸ì˜ ë§ˆë…€",desc:"ë‹¹ì‹ ì˜ ëª¨ì–‘ì„ ê·¸ëŒ€ë¡œ ë”°ë¼í•©ë‹ˆë‹¤.",cardCount:5,hp:12,mimicAll:!0,bgColor:"#0a1a0a",reward:"rare_passive"}},te={1:{passives:[]},4:{passives:["redMatch","blueMatch","bigHand","smallDeck"]},7:{gimmicks:["fourCards","twoCards"],passives:["thirdReverse","redRush","flexibility"]},10:{boss:["guardian"],gimmicks:["fog","mimic","greenOnly"],passives:["recycle","joker","bigHand"]},14:{gimmicks:["corrosion","overload","scissorsOnly"],passives:["smallDeck","redMatch","blueMatch"]},17:{gimmicks:["reversal","purpleAcquire","scissorsAcquire"],passives:["joker","thirdReverse","flexibility"]},20:{boss:["chaos","guardian"],gimmicks:["CLEAR"],passives:["recycle","flexibility","thirdReverse"]},24:{gimmicks:["overload","reversal"],passives:["bigHand","smallDeck","recycle"]},27:{gimmicks:["fog","corrosion","mimic"],passives:["joker","redRush","flexibility"]},30:{boss:["mirror","chaos","guardian"],passives:["joker","bigHand","smallDeck","recycle"]},34:{gimmicks:["overload","reversal","purpleAcquire"],passives:["thirdReverse","redMatch","blueMatch"]},37:{gimmicks:["scissorsAcquire","greenOnly","fog"],passives:["recycle","flexibility","bigHand"]},40:{boss:["mirror","chaos"],passives:["joker","smallDeck","redRush"]}},ne={rounds:te},I={rock:"âœŠ",paper:"âœ‹",scissors:"âœŒï¸"};function ie(){const e=t.currentGimmick,s=t.currentBoss,n=t.nextRoundModifier;let i=3;if(s)if(s.dynamicCards){const c=t.currentBossHealth/t.maxBossHealth;c<=.5?i=s.baseCardCount+2:c<=.75?i=s.baseCardCount+1:i=s.baseCardCount}else s.cardCount?i=s.cardCount:s.baseCardCount&&(i=s.baseCardCount);else e&&e.enemyCardCount&&(i=e.enemyCardCount);n&&n.enemyCardBonus&&(i=Math.max(2,i+n.enemyCardBonus)),t.nextRoundModifier=null;const o=["rock","paper","scissors"],a=["blue","yellow","orange","purple","white","green"],r=[];if(e&&e.usePreviousShapes&&t.previousShapes.length>0){for(let c=0;c<Math.min(i,t.previousShapes.length);c++){const l=a[Math.floor(Math.random()*a.length)];r.push({color:l,shape:t.previousShapes[c],id:`enemy-${c}-${Date.now()}`,hidden:!1})}for(;r.length<i;){const c=o[Math.floor(Math.random()*o.length)],l=a[Math.floor(Math.random()*a.length)];r.push({color:l,shape:c,id:`enemy-${r.length}-${Date.now()}`,hidden:!1})}return r}for(let c=0;c<i;c++){let l=o[Math.floor(Math.random()*o.length)],d=a[Math.floor(Math.random()*a.length)];e&&e.enemyShape&&(l=e.enemyShape),e&&e.enemyColor&&(d=e.enemyColor);let f=!1;e&&e.hiddenIndex===c&&(f=!0),e&&e.hideAllEnemyCards&&(f=!0),e&&e.hideOddCards&&c%2===0&&(f=!0),r.push({color:d,shape:l,id:`enemy-${c}-${Date.now()}`,hidden:f})}return r}function oe(){const e=t.deck;if(e.length===0)return[];const s=t.currentGimmick,n=t.passives,i=t.currentBoss,o=t.deckSize;let a=n.reduce((u,g)=>u+(g.handSizeBonus||0),0);if(i&&i.playerHandBonus&&(a+=i.playerHandBonus),n.some(u=>u.id==="perfectCycle")){const u=e.filter(v=>v.shape==="rock").length,g=e.filter(v=>v.shape==="paper").length,p=e.filter(v=>v.shape==="scissors").length;u===g&&g===p&&u>0&&(a+=1)}const r=e.length;let c=0;s&&s.drawPenalty&&(c=s.drawPenalty);const l=Math.max(1,5+a-c),d=Math.min(Math.max(l,o-(r-l)),r,l);return e.splice(0,d)}function T(e,s,n=null){return n&&n.reverseRPS?e===s?0:e==="paper"&&s==="scissors"||e==="scissors"&&s==="rock"||e==="rock"&&s==="paper"?1:-1:e===s?0:e==="rock"&&s==="scissors"||e==="paper"&&s==="rock"||e==="scissors"&&s==="paper"?1:-1}function D(e,s,n,i){const o=t.passives,a=t.currentGimmick,r=a&&a.disablePassives;if(!r&&o.some(l=>l.id==="lastStand")&&n===i-1&&e.shape==="rock")return{result:1,reason:"ìµœí›„ì˜ ì¼ê²©!",passiveTriggered:"lastStand"};if(!r&&o.some(l=>l.id==="joker")&&e.color==="purple")return{result:1,reason:"ì¡°ì»¤ ë°œë™!",passiveTriggered:"joker"};if(a&&a.rockLosesToScissors&&e.shape==="rock"&&s.shape==="scissors")return{result:-1,reason:"ë¶€ì‹! ë°”ìœ„ê°€ ë¬´ë ¥í™”ë¨",gimmickTriggered:"corrosion"};if(e.shape===s.shape){if(!r&&o.some(l=>l.id==="redMatch")&&e.color==="orange")return{result:1,reason:"ë¶‰ì€ ì‹¬íŒ!",passiveTriggered:"redMatch"};if(!r&&o.some(l=>l.id==="blueMatch")&&e.color==="blue")return{result:1,reason:"í‘¸ë¥¸ ì‹¬íŒ!",passiveTriggered:"blueMatch"};if(!r&&o.some(l=>l.id==="yellowFlash")&&e.color==="yellow")return{result:1,reason:"í™©ê¸ˆ ë¹›!",passiveTriggered:"yellowFlash"}}return!r&&o.some(l=>l.id==="thirdReverse")&&n===2&&T(e.shape,s.shape,a)===-1?{result:1,reason:"ì—­ì „!",passiveTriggered:"thirdReverse"}:!r&&o.some(l=>l.id==="earlyBird")&&n===0&&T(e.shape,s.shape,a)===0?{result:1,reason:"ê¸°ì„  ì œì••!",passiveTriggered:"earlyBird"}:!r&&o.some(l=>l.id==="monochrome")&&new Set(t.deck.map(d=>d.color)).size<=2&&T(e.shape,s.shape,a)===0?{result:1,reason:"ë‹¨ìƒ‰í™”!",passiveTriggered:"monochrome"}:{result:T(e.shape,s.shape,a),reason:null}}function re(){const e=t.playerCards,s=t.enemyCards,n=t.currentGimmick,i=t.passives,o=n&&n.disablePassives;if(n&&n.mimicFirst&&e.length>0&&(s[0]={...s[0],shape:e[0].shape,mimicked:!0}),!o&&i.some(p=>p.id==="rainbowMaster")&&new Set(e.filter(v=>v!==null).map(v=>v.color)).size>=5)return{results:e.map(()=>({result:1,reason:"ë¬´ì§€ê°œ ì§€ë°°ì!",passiveTriggered:"rainbowMaster"})),wins:s.length,losses:0,draws:0,bonusWins:0,totalWins:s.length,isVictory:!0,triggeredPassives:["rainbowMaster"]};let a=0,r=0,c=0;const l=[];t.previousShapes=e.filter(p=>p!==null).map(p=>p.shape);for(let p=0;p<s.length;p++){const v=e[p],ee=s[p];if(!v){l.push({result:-1,reason:"ì¹´ë“œ ì—†ìŒ"}),r++;continue}const q=D(v,ee,p,s.length);l.push(q),q.result===1?a++:q.result===-1?r++:c++}let d=0;!o&&i.some(p=>p.id==="redRush")&&e.filter(v=>v&&v.color==="orange").length>=3&&(d=1),!o&&i.some(p=>p.id==="colorCollector")&&new Set(e.filter(v=>v!==null).map(v=>v.color)).size>=3&&(d+=1);const f=[];l.forEach((p,v)=>{p.passiveTriggered&&!f.includes(p.passiveTriggered)&&f.push(p.passiveTriggered)}),d>0&&(!o&&i.some(p=>p.id==="redRush")&&f.push("redRush"),!o&&i.some(p=>p.id==="colorCollector")&&f.push("colorCollector"));const u=a+d,g=u>r;return{results:l,wins:a,losses:r,draws:c,bonusWins:d,totalWins:u,isVictory:g,triggeredPassives:f}}function ae(e){const s=t.passives,n=t.currentGimmick,i=n&&n.reversedDiscard,o=t.hand.filter((r,c)=>!t.selectedHandIndices.includes(c));let a=0;if(i){let r=[...t.playerCards.filter(c=>c!==null)];if(s.some(c=>c.id==="recycle")){const c=r.findIndex(l=>l.color==="white");if(c!==-1){const l=r.splice(c,1)[0];t.deck.push(l)}}s.some(c=>c.id==="whiteStabilize")&&r.filter(l=>l.color==="white").forEach(l=>{const d=r.indexOf(l);d!==-1&&(r.splice(d,1),t.deck.push(l))}),t.deck.push(...o),t.discardPile.push(...r),a=r.length}else{let r=[...o];if(s.some(c=>c.id==="recycle")){const c=r.findIndex(l=>l.color==="white");if(c!==-1){const l=r.splice(c,1)[0];t.deck.push(l)}}s.some(c=>c.id==="whiteStabilize")&&r.filter(l=>l.color==="white").forEach(l=>{const d=r.indexOf(l);d!==-1&&(r.splice(d,1),t.deck.push(l))}),t.discardPile.push(...r),a=r.length,t.deck.push(...t.playerCards.filter(c=>c!==null))}if(!e.isVictory&&s.some(r=>r.id==="shield")&&(a=Math.max(1,a-1)),!e.isVictory&&s.some(r=>r.id==="blueShield")&&t.playerCards.filter(c=>c&&c.color==="blue").length>=2&&(a=Math.max(1,a-1)),t.deck=$(t.deck),t.hand=[],s.some(r=>r.id==="flexibility")){for(let r=0;r<e.results.length;r++)if(e.results[r].result===1&&t.playerCards[r]?.shape==="paper"){if(t.discardPile.length>0){const c=t.discardPile.pop();t.deck.push(c)}break}}if(s.some(r=>r.id==="greenGrowth")){for(let r=0;r<e.results.length;r++)if(e.results[r].result===1&&t.playerCards[r]?.color==="green"){const l={color:"green",shape:t.playerCards[r].shape,id:`grow-${Date.now()}-${Math.random()}`};t.deck.push(l);break}}if(!e.isVictory&&n&&n.colorCurse){const r=n.cursedColor;if(r){for(let c=0;c<e.results.length;c++)if(e.results[c].result===-1&&t.playerCards[c]?.color===r){const l=t.playerCards[c],d=t.deck.findIndex(f=>f.id===l.id);d!==-1&&t.deck.splice(d,1)}}}return t.lostCardsThisRound=a,t.playerCards=[],t.selectedHandIndices=[],a}function F(e){const s=t.currentGimmick;let n=["blue","yellow","orange","purple","white"],i=["rock","paper","scissors"];s?.acquireColor&&(n=[s.acquireColor]),s?.acquireShape&&(i=[s.acquireShape]);const o=[];for(let a=0;a<e;a++){const r=n[Math.floor(Math.random()*n.length)],c=i[Math.floor(Math.random()*i.length)];o.push({color:r,shape:c,id:`acq-${a}-${Date.now()}-${Math.random()}`})}return o}function ce(){const e=t.deck.length;return e<5?{canContinue:!1,reason:`ë±ì— ì¹´ë“œê°€ ${e}ì¥ë°–ì— ë‚¨ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!`}:{canContinue:!0}}class le{constructor(){this.bgm=null,this.sfxVolume=.5,this.bgmVolume=.3,this.isMuted=!1,this.sounds={cardSelect:"https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3",clash:"https://assets.mixkit.co/active_storage/sfx/1633/1633-preview.mp3",win:"https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3",lose:"https://assets.mixkit.co/active_storage/sfx/270/270-preview.mp3",draw:"https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"}}playSFX(s){if(this.isMuted||!this.sounds[s])return;const n=new Audio(this.sounds[s]);n.volume=this.sfxVolume,n.play().catch(i=>console.warn("Audio play failed:",i))}playBGM(s,n=!0){this.bgm&&this.bgm.pause(),this.bgm=new Audio(s),this.bgm.volume=this.bgmVolume,this.bgm.loop=n,this.bgm.play().catch(i=>console.warn("BGM play failed:",i))}setMute(s){this.isMuted=s,this.bgm&&(this.bgm.muted=s)}toggleMute(){return this.setMute(!this.isMuted),this.isMuted}}const x=new le,H="rps_roguelike_save",j="rps_roguelike_stats";class de{constructor(){this.stats=this.loadStats()}saveGameState(s){try{const n={round:s.round,deck:s.deck,hand:s.hand,discardPile:s.discardPile,deckSize:s.deckSize,passiveIds:s.passives.map(i=>i.id),currentGimmickId:s.currentGimmick?.id||null,currentBossId:s.currentBoss?.id||null,consecutiveWins:s.consecutiveWins,lastWinColors:s.lastWinColors,timestamp:Date.now()};return localStorage.setItem(H,JSON.stringify(n)),!0}catch(n){return console.warn("ì„¸ì´ë¸Œ ì‹¤íŒ¨:",n),!1}}loadGameState(s,n,i){try{const o=localStorage.getItem(H);if(!o)return null;const a=JSON.parse(o),r=a.passiveIds.map(d=>s[d]).filter(d=>d!==void 0),c=a.currentGimmickId?n[a.currentGimmickId]:null,l=a.currentBossId?i[a.currentBossId]:null;return{...a,passives:r,currentGimmick:c,currentBoss:l}}catch(o){return console.warn("ë¡œë“œ ì‹¤íŒ¨:",o),null}}clearGameState(){localStorage.removeItem(H)}hasSave(){return localStorage.getItem(H)!==null}loadStats(){try{const s=localStorage.getItem(j);return s?JSON.parse(s):{bestRound:0,totalGames:0,totalVictories:0}}catch(s){return console.warn("í†µê³„ ë¡œë“œ ì‹¤íŒ¨:",s),{bestRound:0,totalGames:0,totalVictories:0}}}saveStats(s){try{localStorage.setItem(j,JSON.stringify(s))}catch(n){console.warn("í†µê³„ ì €ì¥ ì‹¤íŒ¨:",n)}}updateStatsOnGameOver(s,n){this.stats.totalGames++,n&&this.stats.totalVictories++,s>this.stats.bestRound&&(this.stats.bestRound=s),this.saveStats(this.stats)}getBestRound(){return this.stats.bestRound}}const C=new de,h=e=>document.querySelector(e),m={roundNum:()=>h("#round-num"),deckCount:()=>h("#deck-count"),gimmickDisplay:()=>h("#gimmick-display"),gimmickText:()=>h("#gimmick-text"),enemyCards:()=>h("#enemy-cards"),playerCards:()=>h("#player-cards"),handCards:()=>h("#hand-cards"),actionBtn:()=>h("#action-btn"),passiveList:()=>h("#passive-list"),battleResult:()=>h("#battle-result"),resultText:()=>h("#result-text"),acquireModal:()=>h("#acquire-modal"),acquireInfo:()=>h("#acquire-info"),acquireCards:()=>h("#acquire-cards"),acquireBtn:()=>h("#acquire-btn"),eventModal:()=>h("#event-modal"),eventPassives:()=>h("#event-passives"),eventSkipBtn:()=>h("#event-skip-btn"),gameoverTitle:()=>h("#gameover-title"),gameoverText:()=>h("#gameover-text"),restartBtn:()=>h("#restart-btn"),gimmickAnnounceText:()=>h("#gimmick-announce-text"),gimmickOkBtn:()=>h("#gimmick-ok-btn"),deckTotalCount:()=>h("#deck-total-count"),deckCardList:()=>h("#deck-card-list"),statRock:()=>h("#stat-rock"),statPaper:()=>h("#stat-paper"),statScissors:()=>h("#stat-scissors"),battleLog:()=>h("#battle-log"),branchModal:()=>h("#branch-modal"),branchOptions:()=>h("#branch-options"),acquireModal:()=>h("#acquire-modal"),eventModal:()=>h("#event-modal"),gameoverModal:()=>h("#gameover-modal"),gimmickModal:()=>h("#gimmick-modal"),actionBtn:()=>h("#action-btn"),deckViewBtn:()=>h("#deck-view-btn"),deckCloseBtn:()=>h("#deck-close-btn"),acquireDeckBtn:()=>h("#acquire-deck-btn"),acquireBtn:()=>h("#acquire-btn"),bgmToggleBtn:()=>h("#bgm-toggle"),deckOverlay:()=>h("#deck-overlay"),bossHpContainer:()=>h("#boss-hp-container"),bossName:()=>h("#boss-name"),bossHpCurrent:()=>h("#boss-hp-current"),bossHpMax:()=>h("#boss-hp-max"),bossHpFill:()=>h("#boss-hp-fill")};function L(e,s="passive"){const n=m.battleLog(),i=document.createElement("div");i.className=`log-message ${s}`,i.textContent=e,n.appendChild(i),setTimeout(()=>{i.parentNode&&i.remove()},2e3)}function W(){m.roundNum().textContent=t.round;const e=t.deck.length+t.hand.length;m.deckCount().textContent=e;const s=[...t.deck,...t.hand],n=s.filter(d=>d.shape==="scissors").length,i=s.filter(d=>d.shape==="rock").length,o=s.filter(d=>d.shape==="paper").length,a=h("#scissors-count span"),r=h("#rock-count span"),c=h("#paper-count span");a&&(a.textContent=n),r&&(r.textContent=i),c&&(c.textContent=o);const l=h(".best-info span");if(l){const d=C.getBestRound();l.textContent=d>0?d:"-"}}function V(){const e=m.gimmickDisplay(),s=m.gimmickText();t.currentGimmick?(e.classList.remove("hidden"),s.textContent=t.currentGimmick.desc):e.classList.add("hidden")}function ue(){const e=m.bossHpContainer(),s=m.bossName(),n=m.bossHpCurrent(),i=m.bossHpMax(),o=m.bossHpFill();if(t.currentBoss&&t.maxBossHealth>0){e.classList.remove("hidden"),s.textContent=t.currentBoss.name,n.textContent=Math.max(0,t.currentBossHealth),i.textContent=t.maxBossHealth;const a=Math.max(0,t.currentBossHealth/t.maxBossHealth*100);o.style.width=`${a}%`}else e.classList.add("hidden")}function P(e,s={}){const{isEnemy:n=!1,isPlaced:i=!1,isSelected:o=!1,showResult:a=!1,result:r=null,index:c=-1,slotNumber:l=null}=s,d=["card",e.color];n&&d.push("enemy-card"),i&&d.push("placed"),o&&d.push("selected"),e.hidden&&d.push("hidden-card");let f="";a&&r!==null&&(f=`<div class="result-badge ${r===1?"win":r===-1?"lose":"draw"}">${r===1?"âœ“":r===-1?"âœ—":"âˆ’"}</div>`);let u="";l!==null&&(u=`<div class="slot-badge">${l}</div>`);const g=e.hidden?"?":I[e.shape];return`
    <div class="${d.join(" ")}" data-id="${e.id}" data-index="${c}">
      <span class="shape">${g}</span>
      ${f}
      ${u}
    </div>
  `}function me(){const e=m.enemyCards();e.innerHTML=t.enemyCards.map((s,n)=>P(s,{isEnemy:!0,index:n})).join("")}function he(e){const s=m.playerCards(),n=t.enemyCards.length;let i="";for(let o=0;o<n;o++){const a=t.playerCards[o],r=t.enemyCards[o];if(a){let c=null;r&&!r.hidden&&(c=D(a,r,o,n).result),i+=P(a,{isPlaced:!0,index:o,showResult:c!==null,result:c})}else i+=`<div class="card-slot">${o+1}</div>`}s.innerHTML=i,e&&s.querySelectorAll(".card").forEach(o=>{const a=o.dataset.id;o.addEventListener("click",()=>e(a))})}function fe(e){const s=m.handCards();s.innerHTML=t.hand.map((n,i)=>{const o=t.selectedHandIndices.includes(i);let a=null;if(o){const r=t.playerCards.findIndex(c=>c&&c.id===n.id);r!==-1&&(a=r+1)}return P(n,{isSelected:o,index:i,slotNumber:a})}).join(""),s.querySelectorAll(".card").forEach((n,i)=>{n.addEventListener("click",()=>{x.playSFX("cardSelect"),e(i)})})}function pe(){const e=m.handCards(),s=m.playerCards();e.querySelectorAll(".card").forEach((o,a)=>{const r=t.selectedHandIndices.includes(a);r?o.classList.add("selected"):o.classList.remove("selected");let c=o.querySelector(".slot-badge");if(r){const d=t.playerCards.findIndex(f=>f&&f.id===t.hand[a].id)+1;if(c)c.textContent=d;else{const f=document.createElement("div");f.className="slot-badge",f.textContent=d,o.appendChild(f)}}else c&&c.remove()}),s.querySelectorAll(".card-slot, .card").forEach((o,a)=>{const r=t.playerCards[a],c=t.enemyCards[a];if(r){if(o.classList.contains("card-slot")){const l=document.createElement("div");l.className=`card ${r.color} placed`,l.dataset.id=r.id;let d="";if(c&&!c.hidden){const f=D(r,c,a,t.enemyCards.length),u=f.result===1?"win":f.result===-1?"lose":"draw",g=f.result===1?"âœ“":f.result===-1?"âœ—":"âˆ’";d=`<div class="result-badge ${u}">${g}</div>`}l.innerHTML=`<span class="shape">${I[r.shape]}</span>${d}`,o.replaceWith(l)}}else if(!o.classList.contains("card-slot")){const l=document.createElement("div");l.className="card-slot",l.innerHTML='<span class="slot-num">'+(a+1)+"</span>",o.replaceWith(l)}})}function _(){const e=m.actionBtn(),s=t.enemyCards.length,n=t.playerCards.filter(i=>i!==null).length;n===s?(e.disabled=!1,e.textContent="ì œì¶œí•˜ê¸°!"):(e.disabled=!0,e.textContent=`ì¹´ë“œ ì„ íƒ (${n}/${s})`)}function S(){const e=m.passiveList();if(t.passives.length===0){e.innerHTML='<span style="color: var(--text-secondary); font-size: 12px;">íŒ¨ì‹œë¸Œ ì—†ìŒ</span>';return}e.innerHTML=t.passives.map(s=>`
    <div class="passive-emblem" style="background: ${s.color};">
      ${s.icon}
      <div class="passive-tooltip">${s.name}: ${s.desc}</div>
    </div>
  `).join("")}function ge(e,s){const n=m.battleResult(),i=m.resultText(),o=m.playerCards().querySelectorAll(".card"),a=m.enemyCards().querySelectorAll(".card");if(e.results.forEach((c,l)=>{const d=o[l],f=a[l];if(d){const u=c.result===1?"win":c.result===-1?"lose":"draw",g=c.result===1?"âœ“":c.result===-1?"âœ—":"âˆ’";d.insertAdjacentHTML("beforeend",`<div class="result-badge ${u} pop-in">${g}</div>`)}if(f){const u=c.result===1?"lose":c.result===-1?"win":"draw",g=c.result===1?"âœ—":c.result===-1?"âœ“":"âˆ’";f.insertAdjacentHTML("beforeend",`<div class="result-badge ${u} pop-in">${g}</div>`)}}),t.currentGimmick?.mimicFirst&&t.enemyCards[0]?.mimicked){const c=a[0];c&&(c.querySelector(".shape").textContent=I[t.enemyCards[0].shape])}n.classList.remove("hidden","win","lose");let r="";e.isVictory?(n.classList.add("win"),r=`ğŸ‰ ìŠ¹ë¦¬! (${e.totalWins}ìŠ¹ ${e.losses}íŒ¨)`,e.bonusWins>0&&(r+=` [ë¹¨ê°„ ë§› +${e.bonusWins}]`),x.playSFX("win"),ve()):(n.classList.add("lose"),r=`ğŸ’€ íŒ¨ë°°... (${e.wins}ìŠ¹ ${e.losses}íŒ¨)`,x.playSFX("lose"),Ce()),i.textContent=r,setTimeout(()=>{n.classList.add("hidden"),s()},2e3)}function ve(){typeof confetti=="function"&&confetti({particleCount:150,spread:70,origin:{y:.6},colors:["#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ffffff"]})}function Ce(){const e=h("#game-container");e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake")},500)}function X(e,s,n){const i=m.acquireModal(),o=m.acquireInfo(),a=m.acquireCards(),r=m.acquireBtn();o.textContent=`${e.length}ì¥ ì¤‘ ${s}ì¥ì„ ì„ íƒí•˜ì„¸ìš”`;let c=[];a.innerHTML=e.map((f,u)=>P(f,{isSelected:!1,index:u})).join(""),a.querySelectorAll(".card").forEach((f,u)=>{f.addEventListener("click",()=>{c.includes(u)?(c=c.filter(g=>g!==u),f.classList.remove("selected")):c.length<s&&(c.push(u),f.classList.add("selected")),r.disabled=c.length!==s})}),r.disabled=!0,i.classList.remove("hidden");const d=()=>{r.removeEventListener("click",d),i.classList.add("hidden");const f=c.map(u=>e[u]);n(f)};r.addEventListener("click",d)}function ye(e,s){const n=m.eventModal(),i=m.eventPassives(),o=m.eventSkipBtn();let a=null;const r=()=>{i.innerHTML=e.map(l=>`
      <div class="passive-choice ${a===l.id?"selected":""}" data-id="${l.id}">
        <span class="icon">${l.icon}</span>
        <span class="name">${l.name}</span>
        <span class="desc">${l.desc}</span>
      </div>
    `).join(""),i.querySelectorAll(".passive-choice").forEach(l=>{l.addEventListener("click",()=>{a=l.dataset.id,r(),c();const d=e.find(f=>f.id===a);s(d)})})},c=()=>{n.classList.add("hidden")};o.onclick=()=>{c(),s(null)},r(),n.classList.remove("hidden")}function ke(e,s,n,i){const o=m.eventModal(),a=m.eventPassives(),r=m.eventSkipBtn();r.textContent="ì´ì „ìœ¼ë¡œ",r.style.display="",a.innerHTML=`
    <p style="margin-bottom: 16px;">êµì²´í•  íŒ¨ì‹œë¸Œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
    <p style="margin-bottom: 16px; font-size: 14px; color: var(--text-secondary);">ìƒˆ íŒ¨ì‹œë¸Œ: ${s.icon} ${s.name}</p>
    ${e.map(c=>`
      <div class="passive-choice" data-id="${c.id}">
        <span class="icon">${c.icon}</span>
        <span class="name">${c.name}</span>
        <span class="desc">${c.desc}</span>
      </div>
    `).join("")}
  `,a.querySelectorAll(".passive-choice").forEach(c=>{c.addEventListener("click",()=>{o.classList.add("hidden"),r.textContent="ê±´ë„ˆë›°ê¸°",n(c.dataset.id)})}),r.onclick=()=>{o.classList.add("hidden"),r.textContent="ê±´ë„ˆë›°ê¸°",i&&i()},o.classList.remove("hidden")}function E(e,s,n){const i=m.gameoverModal(),o=m.gameoverTitle(),a=m.gameoverText(),r=m.restartBtn();o.textContent=e?"ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤!":"ğŸ’€ ê²Œì„ ì˜¤ë²„",o.style.color=e?"var(--success)":"var(--danger)",a.textContent=s,i.classList.remove("hidden"),r.onclick=()=>{i.classList.add("hidden"),n()}}function be(e,s){const n=m.gimmickModal(),i=m.gimmickAnnounceText(),o=m.gimmickOkBtn();i.textContent=e.desc,n.classList.remove("hidden"),o.onclick=()=>{n.classList.add("hidden"),s()}}function z(){const e=m.deckOverlay(),s=m.deckTotalCount(),n=m.deckCardList(),i=t.discardPile.map(u=>u.id),o=[...t.deck,...t.hand].filter(u=>!i.includes(u.id)),a=t.hand.map(u=>u.id);s.textContent=o.length;const r=["blue","yellow","orange","purple","white"],c=["rock","paper","scissors"];o.sort((u,g)=>{const p=r.indexOf(u.color)-r.indexOf(g.color);return p!==0?p:c.indexOf(u.shape)-c.indexOf(g.shape)}),n.innerHTML=o.map(u=>{const g=a.includes(u.id),p=["card",u.color];return g&&p.push("in-hand"),`
            <div class="${p.join(" ")}" data-id="${u.id}">
                <span class="shape">${I[u.shape]}</span>
            </div>
        `}).join("");const l=o.filter(u=>u.shape==="rock").length,d=o.filter(u=>u.shape==="paper").length,f=o.filter(u=>u.shape==="scissors").length;m.statRock().textContent=l,m.statPaper().textContent=d,m.statScissors().textContent=f,e.classList.remove("hidden")}function N(){m.deckOverlay().classList.add("hidden")}function xe(e){return new Promise(s=>{const i=m.handCards().querySelectorAll(".card");let o=0,a=0;i.forEach((r,c)=>{e.includes(c)||(a++,setTimeout(()=>{r.classList.add("burning"),Se(r),o++,o===a&&setTimeout(s,800)},c*100))}),a===0&&s()})}function Se(e){const s=e.getBoundingClientRect(),n=e.parentElement;for(let i=0;i<8;i++){const o=document.createElement("div");o.className="ash-particle",o.style.left=`${s.left-n.getBoundingClientRect().left+Math.random()*60}px`,o.style.top=`${s.top-n.getBoundingClientRect().top+40+Math.random()*20}px`,o.style.animationDelay=`${Math.random()*.3}s`,n.appendChild(o),setTimeout(()=>o.remove(),1e3)}}function we(){return new Promise(e=>{const n=m.playerCards().querySelectorAll(".card"),i=m.deckViewBtn(),o=i.getBoundingClientRect();if(n.length===0){e();return}let a=0;n.forEach((r,c)=>{const l=r.getBoundingClientRect(),d=r.cloneNode(!0);d.style.position="fixed",d.style.left=`${l.left}px`,d.style.top=`${l.top}px`,d.style.width=`${l.width}px`,d.style.height=`${l.height}px`,d.style.margin="0",d.style.zIndex="3000",document.body.appendChild(d),r.style.visibility="hidden",setTimeout(()=>{d.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",d.style.left=`${o.left+o.width/2-30}px`,d.style.top=`${o.top+o.height/2-40}px`,d.style.transform="scale(0.3) rotate(360deg)",d.style.opacity="0",setTimeout(()=>{i.classList.add("absorbing"),setTimeout(()=>i.classList.remove("absorbing"),300)},400),setTimeout(()=>{d.remove(),a++,a===n.length&&e()},500)},c*100)})})}function Me(e){return new Promise(s=>{const i=m.handCards().querySelectorAll(".card"),o=m.deckViewBtn(),a=o.getBoundingClientRect();let r=0,c=0;if(i.forEach((l,d)=>{e.includes(d)||c++}),c===0){s();return}i.forEach((l,d)=>{if(!e.includes(d)){const f=l.getBoundingClientRect(),u=l.cloneNode(!0);u.classList.remove("selected"),u.style.position="fixed",u.style.left=`${f.left}px`,u.style.top=`${f.top}px`,u.style.width=`${f.width}px`,u.style.height=`${f.height}px`,u.style.margin="0",u.style.zIndex="3000",u.style.opacity="1",document.body.appendChild(u),l.style.visibility="hidden",setTimeout(()=>{u.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",u.style.left=`${a.left+a.width/2-30}px`,u.style.top=`${a.top+a.height/2-40}px`,u.style.transform="scale(0.3) rotate(360deg)",u.style.opacity="0",setTimeout(()=>{o.classList.add("absorbing"),setTimeout(()=>o.classList.remove("absorbing"),300)},400),setTimeout(()=>{u.remove(),r++,r===c&&s()},500)},d*80)}})})}function Be(){return new Promise(e=>{const n=m.playerCards().querySelectorAll(".card");if(n.length===0){e();return}let i=0;n.forEach((o,a)=>{setTimeout(()=>{o.classList.add("burning"),$e(o),i++,i===n.length&&setTimeout(e,800)},a*100)})})}function $e(e){const s=e.getBoundingClientRect();for(let n=0;n<8;n++){const i=document.createElement("div");i.className="ash-particle",i.style.position="fixed",i.style.left=`${s.left+Math.random()*s.width}px`,i.style.top=`${s.top+s.height/2+Math.random()*20}px`,i.style.animationDelay=`${Math.random()*.3}s`,document.body.appendChild(i),setTimeout(()=>i.remove(),1e3)}}function A(e){e.onApply&&e.onApply(t),t.passives.push(e)}function J(e){const s=t.passives.find(n=>n.id===e);return s&&s.onRemove&&s.onRemove(t),t.passives=t.passives.filter(n=>n.id!==e),s}function w(e=!1){if(e){const s=C.loadGameState(k,y,b);s&&(t.round=s.round,t.deck=s.deck,t.hand=s.hand,t.discardPile=s.discardPile,t.deckSize=s.deckSize,t.passives=s.passives,t.currentGimmick=s.currentGimmick,t.currentBoss=s.currentBoss,t.consecutiveWins=s.consecutiveWins,t.lastWinColors=s.lastWinColors,t.passives.forEach(n=>{n.onApply&&n.onApply(t)}))}else t.reset(),C.clearGameState();x.playBGM("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"),K()}function K(){const e=ce();if(!e.canContinue){E(!1,e.reason,w);return}const s=String(t.round),n=ne.rounds[s];if(n?.boss){const i=n.boss[Math.floor(Math.random()*n.boss.length)];if(b[i]){t.currentBoss=b[i],t.currentBossHealth=b[i].hp,t.maxBossHealth=b[i].hp,t.bossTurnCount=0,t.currentGimmick=null,L(`âš”ï¸ ë³´ìŠ¤ ë“±ì¥: ${b[i].name}!`,"gimmick"),document.body.style.background=b[i].bgColor,M(n);return}}else t.currentBoss=null,document.body.style.background="";if(n?.gimmicks){const i=n.gimmicks[Math.floor(Math.random()*n.gimmicks.length)];i==="CLEAR"?(t.currentGimmick=null,M(n)):y[i]?(t.currentGimmick=y[i],be(t.currentGimmick,()=>{M(n)})):M(n)}else M(n)}function M(e){if(e?.passives&&e.passives.length>0){const s=e.passives,n=t.passives.map(o=>o.id),i=s.filter(o=>k[o]&&!n.includes(o)).map(o=>k[o]);if(i.length>0){const o=$(i).slice(0,2);Ie(o,()=>{B()})}else B()}else B()}function B(){t.phase="battle",t.hand=oe(),t.enemyCards=ie();const e=t.enemyCards.length;t.playerCards=new Array(e).fill(null),t.selectedHandIndices=[],W(),V(),ue(),me(),he(U),fe(Te),S(),_(),m.actionBtn().onclick=Le}function Te(e){const s=t.hand[e];if(s){if(t.selectedHandIndices.includes(e))Y(s,e);else{const n=t.playerCards.findIndex(i=>i===null);n!==-1&&(t.selectedHandIndices.push(e),t.playerCards[n]=s)}Q()}}function U(e){const s=t.hand.findIndex(i=>i&&i.id===e);if(s===-1)return;const n=t.hand[s];Y(n,s),Q()}function Y(e,s){const n=t.playerCards.findIndex(i=>i&&i.id===e.id);n!==-1&&(t.playerCards[n]=null),t.selectedHandIndices=t.selectedHandIndices.filter(i=>i!==s)}function Q(){pe(),He(),_()}function He(){m.playerCards().querySelectorAll(".card").forEach(s=>{s.dataset.bound||(s.dataset.bound="true",s.addEventListener("click",()=>U(s.dataset.id)))})}async function Le(){const e=[...t.selectedHandIndices],s=t.currentGimmick,n=s&&s.reversedDiscard;n?await Me(e):await xe(e);const i=re(),o={joker:"ğŸƒ ì¡°ì»¤ ë°œë™!",redMatch:"ğŸ”´ ë¶‰ì€ ì‹¬íŒ ë°œë™!",blueMatch:"ğŸ”µ í‘¸ë¥¸ ì‹¬íŒ ë°œë™!",thirdReverse:"ğŸ”„ ì—­ì „ì˜ ìš©ì‚¬ ë°œë™!",redRush:"ğŸ ë¹¨ê°„ ë§› +1!"};i.triggeredPassives?.forEach((a,r)=>{setTimeout(()=>{o[a]&&L(o[a],"passive")},r*300)}),ge(i,async()=>{if(i.isVictory){if(t.currentBoss&&(t.currentBossHealth-=i.totalWins,t.bossTurnCount++,t.currentBoss.maxTurns&&t.bossTurnCount>=t.currentBoss.maxTurns&&t.currentBossHealth>0)){C.updateStatsOnGameOver(t.round,!1),C.clearGameState(),E(!1,`${t.currentBoss.name}ì„(ë¥¼) ${t.currentBoss.maxTurns}í„´ ì´ë‚´ì— ì²˜ì¹˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`,w);return}n?await Be():await we();const a=ae(i);t.currentBoss&&t.currentBossHealth<=0?(L(`ğŸ† ${t.currentBoss.name}ì„(ë¥¼) ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤!`,"victory"),t.currentBoss=null,t.currentBossHealth=0,t.maxBossHealth=0,t.bossTurnCount=0,document.body.style.background="",a>0?R(a):G()):t.currentBoss?(L(`âš”ï¸ ë³´ìŠ¤ HP: ${t.currentBossHealth}/${t.maxBossHealth}`,"info"),a>0?R(a,!0):B()):a>0?R(a):G()}else C.updateStatsOnGameOver(t.round,!1),C.clearGameState(),E(!1,`${t.round}ë¼ìš´ë“œì—ì„œ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.`,w)})}function R(e,s=!1){t.phase="acquire";const n=t.deckSize,i=t.deck.length,o=Math.max(0,n-i),a=Math.min(e,o);if(a<=0){O(s);return}if(a<=4){const r=F(a*2);X(r,a,c=>{t.deck.push(...c),t.deck=$(t.deck),O(s)})}else Z(a,s)}function Z(e,s=!1){if(e<=0){O(s);return}const n=Math.min(4,e),i=F(8);X(i,n,o=>{t.deck.push(...o),t.deck=$(t.deck),Z(e-n,s)})}function O(e=!1){C.saveGameState(t),e?B():G()}function Ee(e,s){const n=()=>{ye(e,i=>{i?t.passives.length>=3?ke(t.passives,i,o=>{J(o),A(i),S(),s()},()=>{n()}):(A(i),S(),s()):s()})};n()}function Ie(e,s){t.phase="event",Ee(e,s)}function G(){if(t.round++,t.round>50){C.updateStatsOnGameOver(t.round,!0),C.clearGameState(),E(!0,"50ë¼ìš´ë“œë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!",w);return}C.saveGameState(t),K()}document.addEventListener("DOMContentLoaded",()=>{if(C.hasSave()){const e=confirm("ì €ì¥ëœ ê²Œì„ì„ ì´ì–´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");w(e)}else w();m.deckViewBtn().addEventListener("click",()=>{x.playSFX("cardSelect"),z()}),m.bgmToggleBtn().addEventListener("click",()=>{const e=x.toggleMute();m.bgmToggleBtn().textContent=e?"ğŸ”‡":"ğŸ”Š"}),m.deckCloseBtn().addEventListener("click",()=>{x.playSFX("cardSelect"),N()}),m.acquireDeckBtn().addEventListener("click",z),m.deckOverlay().addEventListener("click",e=>{e.target===m.deckOverlay()&&N()})});window.cheat={state:t,passives:k,gimmicks:y,setGimmick(e){y[e]?(t.currentGimmick=y[e],V(),console.log(`âœ… ê¸°ë¯¹ ì„¤ì •: ${y[e].name}`)):console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ë¯¹:",Object.keys(y).join(", "))},addPassive(e){if(k[e]){if(t.passives.length>=3){console.log("âš ï¸ íŒ¨ì‹œë¸Œê°€ ì´ë¯¸ 3ê°œì…ë‹ˆë‹¤. ë¨¼ì € removePassiveë¡œ ì œê±°í•˜ì„¸ìš”.");return}const s=k[e];A(s),S(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì¶”ê°€: ${s.name}`)}else console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ì‹œë¸Œ:",Object.keys(k).join(", "))},removePassive(e){const s=J(e);s?(S(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì œê±°: ${s.name}`)):console.log("âŒ í˜„ì¬ íŒ¨ì‹œë¸Œ:",t.passives.map(n=>n.id).join(", "))},clearPassives(){t.passives.forEach(e=>{e.onRemove&&e.onRemove(t)}),t.passives=[],S(),console.log("âœ… ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°ë¨")},setRound(e){t.round=e,W(),console.log(`âœ… ë¼ìš´ë“œ ì„¤ì •: ${e}`)},help(){console.log(`
ğŸ® ì¹˜íŠ¸ ëª…ë ¹ì–´ ëª©ë¡:

ğŸ“‹ ìƒíƒœ ë³´ê¸°:
  cheat.state              - í˜„ì¬ ê²Œì„ ìƒíƒœ
  cheat.passives           - ëª¨ë“  íŒ¨ì‹œë¸Œ ëª©ë¡
  cheat.gimmicks           - ëª¨ë“  ê¸°ë¯¹ ëª©ë¡

âš¡ ê¸°ë¯¹ ì„¤ì •:
  cheat.setGimmick('reversal')    - ì—­ì „ì˜ ëŒ€ê°€ ê¸°ë¯¹ ì ìš©

ğŸ”® íŒ¨ì‹œë¸Œ ê´€ë¦¬:
  cheat.addPassive('bigHand')     - í° ì† íŒ¨ì‹œë¸Œ ì¶”ê°€
  cheat.removePassive('bigHand')  - í° ì† íŒ¨ì‹œë¸Œ ì œê±°
  cheat.clearPassives()           - ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°

ğŸ”¢ ë¼ìš´ë“œ:
  cheat.setRound(10)              - 10ë¼ìš´ë“œë¡œ ì„¤ì •

ğŸ“¦ ì‚¬ìš© ê°€ëŠ¥í•œ ID:
  ê¸°ë¯¹: ${Object.keys(y).join(", ")}
  íŒ¨ì‹œë¸Œ: ${Object.keys(k).join(", ")}
    `)}};console.log("ğŸ® ì¹˜íŠ¸ ì‚¬ìš©ë²•: cheat.help()");
