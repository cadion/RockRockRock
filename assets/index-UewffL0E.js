(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function Z(){const e=["blue","yellow","orange","purple","white"],s=["rock","paper","scissors"],n=[];for(const o of e)for(const i of s)n.push({color:o,shape:i,id:`${o}-${i}-${Date.now()}-${Math.random()}`});return w(n)}function w(e){const s=[...e];for(let n=s.length-1;n>0;n--){const o=Math.floor(Math.random()*(n+1));[s[n],s[o]]=[s[o],s[n]]}return s}const t={round:1,deck:[],hand:[],discardPile:[],passives:[],currentGimmick:null,currentBoss:null,deckSize:15,enemyCards:[],playerCards:[],selectedHandIndices:[],lostCardsThisRound:0,consecutiveWins:0,lastWinColors:[],phase:"battle",nextRoundModifier:null,reset(){this.round=1,this.deck=Z(),this.hand=[],this.discardPile=[],this.passives=[],this.currentGimmick=null,this.currentBoss=null,this.deckSize=15,this.enemyCards=[],this.playerCards=[],this.selectedHandIndices=[],this.lostCardsThisRound=0,this.consecutiveWins=0,this.lastWinColors=[],this.phase="battle",this.nextRoundModifier=null}},k={redMatch:{id:"redMatch",name:"ë¶‰ì€ ì‹¬íŒ",icon:"ğŸ”´",desc:"ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#e74c3c"},blueMatch:{id:"blueMatch",name:"í‘¸ë¥¸ ì‹¬íŒ",icon:"ğŸ”µ",desc:"íŒŒë€ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#3498db"},thirdReverse:{id:"thirdReverse",name:"ì—­ì „ì˜ ìš©ì‚¬",icon:"ğŸ”„",desc:"ì„¸ ë²ˆì§¸ ì¹´ë“œëŠ” ì§€ëŠ” ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#9b59b6"},redRush:{id:"redRush",name:"ë¹¨ê°„ ë§›",icon:"ğŸ",desc:"í•„ë“œì— ë¹¨ê°„ìƒ‰ ì¹´ë“œê°€ 3ì¥ ì´ìƒì´ë©´ ìŠ¹ì  +1",color:"#c0392b"},flexibility:{id:"flexibility",name:"ìœ ì—°í•¨",icon:"ğŸŒŠ",desc:"ë³´ë¡œ ì´ê¸°ë©´ ë²„ë ¤ì§„ ì¹´ë“œ 1ì¥ ë³µêµ¬",color:"#2980b9"},recycle:{id:"recycle",name:"ì¬í™œìš©",icon:"â™»ï¸",desc:"ë²„ë ¤ì§ˆ í°ìƒ‰ ì¹´ë“œ 1ì¥ì€ ë±ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤",color:"#95a5a6"},joker:{id:"joker",name:"ì¡°ì»¤",icon:"ğŸƒ",desc:"ë³´ë¼ìƒ‰ ì¹´ë“œëŠ” ë¬´ì¡°ê±´ ìŠ¹ë¦¬ (ëª¨ì–‘ ë¬´ì‹œ)",color:"#8e44ad"},bigHand:{id:"bigHand",name:"í° ì†",icon:"ğŸ–ï¸",desc:"í•¸ë“œ í¬ê¸°ê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤ (6ì¥)",color:"#27ae60",handSizeBonus:1},smallDeck:{id:"smallDeck",name:"ì••ì¶•",icon:"ğŸ“¦",desc:"ë± í¬ê¸°ê°€ 1 ê°ì†Œí•©ë‹ˆë‹¤",color:"#e67e22",onApply:e=>{e.deckSize-=1},onRemove:e=>{e.deckSize+=1}}},y={fourCards:{id:"fourCards",name:"4ì—°íƒ€",desc:"ì ì´ íŒ¨ë¥¼ 4ê°œ ëƒ…ë‹ˆë‹¤",enemyCardCount:4},twoCards:{id:"twoCards",name:"ê°€ë²¼ìš´ ì „íˆ¬",desc:"ì ì´ íŒ¨ë¥¼ 2ê°œë§Œ ëƒ…ë‹ˆë‹¤",enemyCardCount:2},greenOnly:{id:"greenOnly",name:"ì´ˆë¡ ì „ì—¼ë³‘",desc:"ì ì´ ì´ˆë¡ìƒ‰ íŒ¨ë§Œ ëƒ…ë‹ˆë‹¤",enemyColor:"green"},scissorsOnly:{id:"scissorsOnly",name:"ê°€ìœ„ ë°”ëŒ",desc:"ì ì´ ê°€ìœ„ë§Œ ëƒ…ë‹ˆë‹¤",enemyShape:"scissors"},fog:{id:"fog",name:"ì•ˆê°œ",desc:"ì ì˜ ê°€ìš´ë° íŒ¨ê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",hiddenIndex:1},mimic:{id:"mimic",name:"ëª¨ë°©",desc:"ì ì˜ ì²« ë²ˆì§¸ íŒ¨ê°€ ë‹¹ì‹ ì˜ ì„ íƒì„ ë”°ë¼í•©ë‹ˆë‹¤",mimicFirst:!0},corrosion:{id:"corrosion",name:"ë¶€ì‹",desc:"ì´ë²ˆ ë¼ìš´ë“œ, ë°”ìœ„ëŠ” ê°€ìœ„ì—ê²Œ ì§‘ë‹ˆë‹¤",rockLosesToScissors:!0},overload:{id:"overload",name:"í­ì£¼",desc:"ì ì´ íŒ¨ë¥¼ 5ê°œ ëƒ…ë‹ˆë‹¤! (í•¸ë“œ ì „ë¶€ ì‚¬ìš©)",enemyCardCount:5},reversal:{id:"reversal",name:"ì—­ì „ì˜ ëŒ€ê°€",desc:"í•¸ë“œ ì¹´ë“œëŠ” ë±ìœ¼ë¡œ, í•„ë“œ ì¹´ë“œëŠ” ì†Œë©¸í•©ë‹ˆë‹¤",reversedDiscard:!0},purpleAcquire:{id:"purpleAcquire",name:"ë³´ë¼ìƒ‰ í­í’",desc:"ì¹´ë“œ íšë“ ì‹œ ë³´ë¼ìƒ‰ë§Œ ë“±ì¥í•©ë‹ˆë‹¤",acquireColor:"purple"},scissorsAcquire:{id:"scissorsAcquire",name:"ê°€ìœ„ ì„¸ë¡€",desc:"ì¹´ë“œ íšë“ ì‹œ ê°€ìœ„ë§Œ ë“±ì¥í•©ë‹ˆë‹¤",acquireShape:"scissors"}},S={guardian:{id:"guardian",name:"ìˆ˜í˜¸ì",desc:"6ì¥ì˜ ì¹´ë“œë¡œ ë‹¹ì‹ ì„ ì••ë°•í•©ë‹ˆë‹¤",cardCount:6,bgColor:"#1a0a0a",reward:"rare_passive"},chaos:{id:"chaos",name:"í˜¼ëˆì˜ êµ°ì£¼",desc:"7ì¥ì˜ ì¹´ë“œì™€ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ íŒ¨í„´",cardCount:7,bgColor:"#0a0a1a",reward:"deck_purge"},mirror:{id:"mirror",name:"ê±°ìš¸ì˜ ë§ˆë…€",desc:"ë‹¹ì‹ ì˜ ëª¨ì–‘ì„ ê·¸ëŒ€ë¡œ ë”°ë¼í•©ë‹ˆë‹¤",cardCount:5,mimicAll:!0,bgColor:"#0a1a0a",reward:"rare_passive"}},ee={1:{passives:[]},4:{passives:["redMatch","blueMatch","bigHand","smallDeck"]},7:{gimmicks:["fourCards","twoCards"],passives:["thirdReverse","redRush","flexibility"]},10:{boss:["guardian"],gimmicks:["fog","mimic","greenOnly"],passives:["recycle","joker","bigHand"]},14:{gimmicks:["corrosion","overload","scissorsOnly"],passives:["smallDeck","redMatch","blueMatch"]},17:{gimmicks:["reversal","purpleAcquire","scissorsAcquire"],passives:["joker","thirdReverse","flexibility"]},20:{boss:["chaos","guardian"],gimmicks:["CLEAR"],passives:["recycle","flexibility","thirdReverse"]},24:{gimmicks:["overload","reversal"],passives:["bigHand","smallDeck","recycle"]},27:{gimmicks:["fog","corrosion","mimic"],passives:["joker","redRush","flexibility"]},30:{boss:["mirror","chaos","guardian"],passives:["joker","bigHand","smallDeck","recycle"]},34:{gimmicks:["overload","reversal","purpleAcquire"],passives:["thirdReverse","redMatch","blueMatch"]},37:{gimmicks:["scissorsAcquire","greenOnly","fog"],passives:["recycle","flexibility","bigHand"]},40:{boss:["mirror","chaos"],passives:["joker","smallDeck","redRush"]}},se={rounds:ee},B={rock:"âœŠ",paper:"âœ‹",scissors:"âœŒï¸"};function te(){const e=t.currentGimmick,s=t.currentBoss,n=t.nextRoundModifier;let o=3;s&&s.cardCount?o=s.cardCount:e&&e.enemyCardCount&&(o=e.enemyCardCount),n&&n.enemyCardBonus&&(o=Math.max(2,o+n.enemyCardBonus)),t.nextRoundModifier=null;const i=["rock","paper","scissors"],r=["blue","yellow","orange","purple","white","green"],c=[];for(let a=0;a<o;a++){let d=i[Math.floor(Math.random()*i.length)],l=r[Math.floor(Math.random()*r.length)];e&&e.enemyShape&&(d=e.enemyShape),e&&e.enemyColor&&(l=e.enemyColor);const p=e&&e.hiddenIndex===a;c.push({color:l,shape:d,id:`enemy-${a}-${Date.now()}`,hidden:p})}return c}function ne(){const e=t.deck;if(e.length===0)return[];const s=t.deckSize,n=t.passives.reduce((a,d)=>a+(d.handSizeBonus||0),0),o=e.length,i=5+n,r=Math.min(Math.max(i,s-(o-i)),o,i);return e.splice(0,r)}function O(e,s){return e===s?0:e==="rock"&&s==="scissors"||e==="paper"&&s==="rock"||e==="scissors"&&s==="paper"?1:-1}function q(e,s,n,o){const i=t.passives,r=t.currentGimmick;if(i.some(a=>a.id==="joker")&&e.color==="purple")return{result:1,reason:"ì¡°ì»¤ ë°œë™!",passiveTriggered:"joker"};if(r&&r.rockLosesToScissors&&e.shape==="rock"&&s.shape==="scissors")return{result:-1,reason:"ë¶€ì‹! ë°”ìœ„ê°€ ë¬´ë ¥í™”ë¨",gimmickTriggered:"corrosion"};if(e.shape===s.shape){if(i.some(a=>a.id==="redMatch")&&e.color==="orange")return{result:1,reason:"ë¶‰ì€ ì‹¬íŒ!",passiveTriggered:"redMatch"};if(i.some(a=>a.id==="blueMatch")&&e.color==="blue")return{result:1,reason:"í‘¸ë¥¸ ì‹¬íŒ!",passiveTriggered:"blueMatch"}}return i.some(a=>a.id==="thirdReverse")&&n===2&&O(e.shape,s.shape)===-1?{result:1,reason:"ì—­ì „!",passiveTriggered:"thirdReverse"}:{result:O(e.shape,s.shape),reason:null}}function ie(){const e=t.playerCards,s=t.enemyCards,n=t.currentGimmick;n&&n.mimicFirst&&e.length>0&&(s[0]={...s[0],shape:e[0].shape,mimicked:!0});let o=0,i=0,r=0;const c=[];for(let f=0;f<s.length;f++){const g=e[f],A=s[f];if(!g){c.push({result:-1,reason:"ì¹´ë“œ ì—†ìŒ"}),i++;continue}const $=q(g,A,f,s.length);c.push($),$.result===1?o++:$.result===-1?i++:r++}const a=t.passives;let d=0;a.some(f=>f.id==="redRush")&&e.filter(g=>g.color==="orange").length>=3&&(d=1);const l=[];c.forEach((f,g)=>{f.passiveTriggered&&!l.includes(f.passiveTriggered)&&l.push(f.passiveTriggered)}),d>0&&l.push("redRush");const p=o+d,u=p>i;return{results:c,wins:o,losses:i,draws:r,bonusWins:d,totalWins:p,isVictory:u,triggeredPassives:l}}function oe(e){const s=t.passives,n=t.currentGimmick,o=n&&n.reversedDiscard,i=t.hand.filter((c,a)=>!t.selectedHandIndices.includes(a));let r=0;if(o){let c=[...t.playerCards.filter(a=>a!==null)];if(s.some(a=>a.id==="recycle")){const a=c.findIndex(d=>d.color==="white");if(a!==-1){const d=c.splice(a,1)[0];t.deck.push(d)}}t.deck.push(...i),t.discardPile.push(...c),r=c.length}else{let c=[...i];if(s.some(a=>a.id==="recycle")){const a=c.findIndex(d=>d.color==="white");if(a!==-1){const d=c.splice(a,1)[0];t.deck.push(d)}}t.discardPile.push(...c),r=c.length,t.deck.push(...t.playerCards.filter(a=>a!==null))}if(t.deck=w(t.deck),t.hand=[],s.some(c=>c.id==="flexibility")){for(let c=0;c<e.results.length;c++)if(e.results[c].result===1&&t.playerCards[c]?.shape==="paper"){if(t.discardPile.length>0){const a=t.discardPile.pop();t.deck.push(a)}break}}return t.lostCardsThisRound=r,t.playerCards=[],t.selectedHandIndices=[],r}function D(e){const s=t.currentGimmick;let n=["blue","yellow","orange","purple","white"],o=["rock","paper","scissors"];s?.acquireColor&&(n=[s.acquireColor]),s?.acquireShape&&(o=[s.acquireShape]);const i=[];for(let r=0;r<e;r++){const c=n[Math.floor(Math.random()*n.length)],a=o[Math.floor(Math.random()*o.length)];let d=null;const l=Math.random();l<.05?d="cursed":l<.15&&(d="gold"),i.push({color:c,shape:a,id:`acq-${r}-${Date.now()}-${Math.random()}`,special:d})}return i}function ae(){const e=t.deck.length;return e<5?{canContinue:!1,reason:`ë±ì— ì¹´ë“œê°€ ${e}ì¥ë°–ì— ë‚¨ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!`}:{canContinue:!0}}class ce{constructor(){this.bgm=null,this.sfxVolume=.5,this.bgmVolume=.3,this.isMuted=!1,this.sounds={cardSelect:"https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3",clash:"https://assets.mixkit.co/active_storage/sfx/1633/1633-preview.mp3",win:"https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3",lose:"https://assets.mixkit.co/active_storage/sfx/270/270-preview.mp3",draw:"https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"}}playSFX(s){if(this.isMuted||!this.sounds[s])return;const n=new Audio(this.sounds[s]);n.volume=this.sfxVolume,n.play().catch(o=>console.warn("Audio play failed:",o))}playBGM(s,n=!0){this.bgm&&this.bgm.pause(),this.bgm=new Audio(s),this.bgm.volume=this.bgmVolume,this.bgm.loop=n,this.bgm.play().catch(o=>console.warn("BGM play failed:",o))}setMute(s){this.isMuted=s,this.bgm&&(this.bgm.muted=s)}}const b=new ce,L="rps_roguelike_save",G="rps_roguelike_stats";class re{constructor(){this.stats=this.loadStats()}saveGameState(s){try{const n={round:s.round,deck:s.deck,hand:s.hand,discardPile:s.discardPile,deckSize:s.deckSize,passiveIds:s.passives.map(o=>o.id),currentGimmickId:s.currentGimmick?.id||null,currentBossId:s.currentBoss?.id||null,consecutiveWins:s.consecutiveWins,lastWinColors:s.lastWinColors,timestamp:Date.now()};return localStorage.setItem(L,JSON.stringify(n)),!0}catch(n){return console.warn("ì„¸ì´ë¸Œ ì‹¤íŒ¨:",n),!1}}loadGameState(s,n,o){try{const i=localStorage.getItem(L);if(!i)return null;const r=JSON.parse(i),c=r.passiveIds.map(l=>s[l]).filter(l=>l!==void 0),a=r.currentGimmickId?n[r.currentGimmickId]:null,d=r.currentBossId?o[r.currentBossId]:null;return{...r,passives:c,currentGimmick:a,currentBoss:d}}catch(i){return console.warn("ë¡œë“œ ì‹¤íŒ¨:",i),null}}clearGameState(){localStorage.removeItem(L)}hasSave(){return localStorage.getItem(L)!==null}loadStats(){try{const s=localStorage.getItem(G);return s?JSON.parse(s):{bestRound:0,totalGames:0,totalVictories:0}}catch(s){return console.warn("í†µê³„ ë¡œë“œ ì‹¤íŒ¨:",s),{bestRound:0,totalGames:0,totalVictories:0}}}saveStats(s){try{localStorage.setItem(G,JSON.stringify(s))}catch(n){console.warn("í†µê³„ ì €ì¥ ì‹¤íŒ¨:",n)}}updateStatsOnGameOver(s,n){this.stats.totalGames++,n&&this.stats.totalVictories++,s>this.stats.bestRound&&(this.stats.bestRound=s),this.saveStats(this.stats)}getBestRound(){return this.stats.bestRound}}const v=new re,h=e=>document.querySelector(e),m={roundNum:()=>h("#round-num"),deckCount:()=>h("#deck-count"),gimmickDisplay:()=>h("#gimmick-display"),gimmickText:()=>h("#gimmick-text"),enemyCards:()=>h("#enemy-cards"),playerCards:()=>h("#player-cards"),handCards:()=>h("#hand-cards"),actionBtn:()=>h("#action-btn"),passiveList:()=>h("#passive-list"),battleResult:()=>h("#battle-result"),resultText:()=>h("#result-text"),acquireModal:()=>h("#acquire-modal"),acquireInfo:()=>h("#acquire-info"),acquireCards:()=>h("#acquire-cards"),acquireBtn:()=>h("#acquire-btn"),eventModal:()=>h("#event-modal"),eventPassives:()=>h("#event-passives"),eventSkipBtn:()=>h("#event-skip-btn"),gameoverModal:()=>h("#gameover-modal"),gameoverTitle:()=>h("#gameover-title"),gameoverText:()=>h("#gameover-text"),restartBtn:()=>h("#restart-btn"),gimmickModal:()=>h("#gimmick-modal"),gimmickAnnounceText:()=>h("#gimmick-announce-text"),gimmickOkBtn:()=>h("#gimmick-ok-btn"),deckViewBtn:()=>h("#deck-view-btn"),deckOverlay:()=>h("#deck-overlay"),deckTotalCount:()=>h("#deck-total-count"),deckCardList:()=>h("#deck-card-list"),deckCloseBtn:()=>h("#deck-close-btn"),statRock:()=>h("#stat-rock"),statPaper:()=>h("#stat-paper"),statScissors:()=>h("#stat-scissors"),acquireDeckBtn:()=>h("#acquire-deck-btn"),battleLog:()=>h("#battle-log"),branchModal:()=>h("#branch-modal"),branchOptions:()=>h("#branch-options")};function N(e,s="passive"){const n=m.battleLog(),o=document.createElement("div");o.className=`log-message ${s}`,o.textContent=e,n.appendChild(o),setTimeout(()=>{o.parentNode&&o.remove()},2e3)}function z(){m.roundNum().textContent=t.round;const e=t.deck.length+t.hand.length;m.deckCount().textContent=e;const s=[...t.deck,...t.hand],n=s.filter(l=>l.shape==="scissors").length,o=s.filter(l=>l.shape==="rock").length,i=s.filter(l=>l.shape==="paper").length,r=h("#scissors-count span"),c=h("#rock-count span"),a=h("#paper-count span");r&&(r.textContent=n),c&&(c.textContent=o),a&&(a.textContent=i);const d=h(".best-info span");if(d){const l=v.getBestRound();d.textContent=l>0?l:"-"}}function W(){const e=m.gimmickDisplay(),s=m.gimmickText();t.currentGimmick?(e.classList.remove("hidden"),s.textContent=t.currentGimmick.desc):e.classList.add("hidden")}function E(e,s={}){const{isEnemy:n=!1,isPlaced:o=!1,isSelected:i=!1,showResult:r=!1,result:c=null,index:a=-1,slotNumber:d=null}=s,l=["card",e.color];n&&l.push("enemy-card"),o&&l.push("placed"),i&&l.push("selected"),e.hidden&&l.push("hidden-card"),e.special&&l.push(`special-${e.special}`);let p="";r&&c!==null&&(p=`<div class="result-badge ${c===1?"win":c===-1?"lose":"draw"}">${c===1?"âœ“":c===-1?"âœ—":"âˆ’"}</div>`);let u="";d!==null&&(u=`<div class="slot-badge">${d}</div>`);let f="";e.special==="gold"?f='<div class="special-badge gold">âœ¨</div>':e.special==="cursed"&&(f='<div class="special-badge cursed">ğŸ’€</div>');const g=e.hidden?"?":B[e.shape];return`
    <div class="${l.join(" ")}" data-id="${e.id}" data-index="${a}">
      <span class="shape">${g}</span>
      ${p}
      ${u}
      ${f}
    </div>
  `}function de(){const e=m.enemyCards();e.innerHTML=t.enemyCards.map((s,n)=>E(s,{isEnemy:!0,index:n})).join("")}function le(e){const s=m.playerCards(),n=t.enemyCards.length;let o="";for(let i=0;i<n;i++){const r=t.playerCards[i],c=t.enemyCards[i];if(r){let a=null;c&&!c.hidden&&(a=q(r,c,i).result),o+=E(r,{isPlaced:!0,index:i,showResult:a!==null,result:a})}else o+=`<div class="card-slot">${i+1}</div>`}s.innerHTML=o,e&&s.querySelectorAll(".card").forEach(i=>{const r=i.dataset.id;i.addEventListener("click",()=>e(r))})}function ue(e){const s=m.handCards();s.innerHTML=t.hand.map((n,o)=>{const i=t.selectedHandIndices.includes(o);let r=null;if(i){const c=t.playerCards.findIndex(a=>a&&a.id===n.id);c!==-1&&(r=c+1)}return E(n,{isSelected:i,index:o,slotNumber:r})}).join(""),s.querySelectorAll(".card").forEach((n,o)=>{n.addEventListener("click",()=>{b.playSFX("cardSelect"),e(o)})})}function me(){const e=m.handCards(),s=m.playerCards();e.querySelectorAll(".card").forEach((i,r)=>{const c=t.selectedHandIndices.includes(r);c?i.classList.add("selected"):i.classList.remove("selected");let a=i.querySelector(".slot-badge");if(c){const l=t.playerCards.findIndex(p=>p&&p.id===t.hand[r].id)+1;if(a)a.textContent=l;else{const p=document.createElement("div");p.className="slot-badge",p.textContent=l,i.appendChild(p)}}else a&&a.remove()}),s.querySelectorAll(".card-slot, .card").forEach((i,r)=>{const c=t.playerCards[r],a=t.enemyCards[r];if(c){if(i.classList.contains("card-slot")){const d=document.createElement("div");d.className=`card ${c.color} placed`,c.special&&d.classList.add(`special-${c.special}`),d.dataset.id=c.id;let l="";if(a&&!a.hidden){const p=q(c,a,r,t.enemyCards.length),u=p.result===1?"win":p.result===-1?"lose":"draw",f=p.result===1?"âœ“":p.result===-1?"âœ—":"âˆ’";l=`<div class="result-badge ${u}">${f}</div>`}d.innerHTML=`<span class="shape">${B[c.shape]}</span>${l}`,i.replaceWith(d)}}else if(!i.classList.contains("card-slot")){const d=document.createElement("div");d.className="card-slot",d.innerHTML='<span class="slot-num">'+(r+1)+"</span>",i.replaceWith(d)}})}function F(){const e=m.actionBtn(),s=t.enemyCards.length,n=t.playerCards.filter(o=>o!==null).length;n===s?(e.disabled=!1,e.textContent="ì œì¶œí•˜ê¸°!"):(e.disabled=!0,e.textContent=`ì¹´ë“œ ì„ íƒ (${n}/${s})`)}function C(){const e=m.passiveList();if(t.passives.length===0){e.innerHTML='<span style="color: var(--text-secondary); font-size: 12px;">íŒ¨ì‹œë¸Œ ì—†ìŒ</span>';return}e.innerHTML=t.passives.map(s=>`
    <div class="passive-emblem" style="background: ${s.color};">
      ${s.icon}
      <div class="passive-tooltip">${s.name}: ${s.desc}</div>
    </div>
  `).join("")}function he(e,s){const n=m.battleResult(),o=m.resultText(),i=m.playerCards().querySelectorAll(".card"),r=m.enemyCards().querySelectorAll(".card");if(e.results.forEach((a,d)=>{const l=i[d],p=r[d];if(l){const u=a.result===1?"win":a.result===-1?"lose":"draw",f=a.result===1?"âœ“":a.result===-1?"âœ—":"âˆ’";l.insertAdjacentHTML("beforeend",`<div class="result-badge ${u} pop-in">${f}</div>`)}if(p){const u=a.result===1?"lose":a.result===-1?"win":"draw",f=a.result===1?"âœ—":a.result===-1?"âœ“":"âˆ’";p.insertAdjacentHTML("beforeend",`<div class="result-badge ${u} pop-in">${f}</div>`)}}),t.currentGimmick?.mimicFirst&&t.enemyCards[0]?.mimicked){const a=r[0];a&&(a.querySelector(".shape").textContent=B[t.enemyCards[0].shape])}n.classList.remove("hidden","win","lose");let c="";e.isVictory?(n.classList.add("win"),c=`ğŸ‰ ìŠ¹ë¦¬! (${e.totalWins}ìŠ¹ ${e.losses}íŒ¨)`,e.bonusWins>0&&(c+=` [ë¹¨ê°„ ë§› +${e.bonusWins}]`),b.playSFX("win"),pe()):(n.classList.add("lose"),c=`ğŸ’€ íŒ¨ë°°... (${e.wins}ìŠ¹ ${e.losses}íŒ¨)`,b.playSFX("lose"),fe()),o.textContent=c,setTimeout(()=>{n.classList.add("hidden"),s()},2e3)}function pe(){typeof confetti=="function"&&confetti({particleCount:150,spread:70,origin:{y:.6},colors:["#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ffffff"]})}function fe(){const e=h("#game-container");e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake")},500)}function V(e,s,n){const o=m.acquireModal(),i=m.acquireInfo(),r=m.acquireCards(),c=m.acquireBtn();i.textContent=`${e.length}ì¥ ì¤‘ ${s}ì¥ì„ ì„ íƒí•˜ì„¸ìš”`;let a=[];r.innerHTML=e.map((p,u)=>E(p,{isSelected:!1,index:u})).join(""),r.querySelectorAll(".card").forEach((p,u)=>{p.addEventListener("click",()=>{a.includes(u)?(a=a.filter(f=>f!==u),p.classList.remove("selected")):a.length<s&&(a.push(u),p.classList.add("selected")),c.disabled=a.length!==s})}),c.disabled=!0,o.classList.remove("hidden");const l=()=>{c.removeEventListener("click",l),o.classList.add("hidden");const p=a.map(u=>e[u]);n(p)};c.addEventListener("click",l)}function ge(e,s){const n=m.eventModal(),o=m.eventPassives(),i=m.eventSkipBtn();let r=null;const c=()=>{o.innerHTML=e.map(d=>`
      <div class="passive-choice ${r===d.id?"selected":""}" data-id="${d.id}">
        <span class="icon">${d.icon}</span>
        <span class="name">${d.name}</span>
        <span class="desc">${d.desc}</span>
      </div>
    `).join(""),o.querySelectorAll(".passive-choice").forEach(d=>{d.addEventListener("click",()=>{r=d.dataset.id,c(),a();const l=e.find(p=>p.id===r);s(l)})})},a=()=>{n.classList.add("hidden")};i.onclick=()=>{a(),s(null)},c(),n.classList.remove("hidden")}function ve(e,s,n,o){const i=m.eventModal(),r=m.eventPassives(),c=m.eventSkipBtn();c.textContent="ì´ì „ìœ¼ë¡œ",c.style.display="",r.innerHTML=`
    <p style="margin-bottom: 16px;">êµì²´í•  íŒ¨ì‹œë¸Œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
    <p style="margin-bottom: 16px; font-size: 14px; color: var(--text-secondary);">ìƒˆ íŒ¨ì‹œë¸Œ: ${s.icon} ${s.name}</p>
    ${e.map(a=>`
      <div class="passive-choice" data-id="${a.id}">
        <span class="icon">${a.icon}</span>
        <span class="name">${a.name}</span>
        <span class="desc">${a.desc}</span>
      </div>
    `).join("")}
  `,r.querySelectorAll(".passive-choice").forEach(a=>{a.addEventListener("click",()=>{i.classList.add("hidden"),c.textContent="ê±´ë„ˆë›°ê¸°",n(a.dataset.id)})}),c.onclick=()=>{i.classList.add("hidden"),c.textContent="ê±´ë„ˆë›°ê¸°",o&&o()},i.classList.remove("hidden")}function P(e,s,n){const o=m.gameoverModal(),i=m.gameoverTitle(),r=m.gameoverText(),c=m.restartBtn();i.textContent=e?"ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤!":"ğŸ’€ ê²Œì„ ì˜¤ë²„",i.style.color=e?"var(--success)":"var(--danger)",r.textContent=s,o.classList.remove("hidden"),c.onclick=()=>{o.classList.add("hidden"),n()}}function ye(e,s){const n=m.gimmickModal(),o=m.gimmickAnnounceText(),i=m.gimmickOkBtn();o.textContent=e.desc,n.classList.remove("hidden"),i.onclick=()=>{n.classList.add("hidden"),s()}}function H(){const e=m.deckOverlay(),s=m.deckTotalCount(),n=m.deckCardList(),o=t.discardPile.map(u=>u.id),i=[...t.deck,...t.hand].filter(u=>!o.includes(u.id)),r=t.hand.map(u=>u.id);s.textContent=i.length;const c=["blue","yellow","orange","purple","white"],a=["rock","paper","scissors"];i.sort((u,f)=>{const g=c.indexOf(u.color)-c.indexOf(f.color);return g!==0?g:a.indexOf(u.shape)-a.indexOf(f.shape)}),n.innerHTML=i.map(u=>{const f=r.includes(u.id),g=["card",u.color];return f&&g.push("in-hand"),`
            <div class="${g.join(" ")}" data-id="${u.id}">
                <span class="shape">${B[u.shape]}</span>
            </div>
        `}).join("");const d=i.filter(u=>u.shape==="rock").length,l=i.filter(u=>u.shape==="paper").length,p=i.filter(u=>u.shape==="scissors").length;m.statRock().textContent=d,m.statPaper().textContent=l,m.statScissors().textContent=p,e.classList.remove("hidden")}function j(){m.deckOverlay().classList.add("hidden")}function ke(e){return new Promise(s=>{const o=m.handCards().querySelectorAll(".card");let i=0,r=0;o.forEach((c,a)=>{e.includes(a)||(r++,setTimeout(()=>{c.classList.add("burning"),Ce(c),i++,i===r&&setTimeout(s,800)},a*100))}),r===0&&s()})}function Ce(e){const s=e.getBoundingClientRect(),n=e.parentElement;for(let o=0;o<8;o++){const i=document.createElement("div");i.className="ash-particle",i.style.left=`${s.left-n.getBoundingClientRect().left+Math.random()*60}px`,i.style.top=`${s.top-n.getBoundingClientRect().top+40+Math.random()*20}px`,i.style.animationDelay=`${Math.random()*.3}s`,n.appendChild(i),setTimeout(()=>i.remove(),1e3)}}function be(){return new Promise(e=>{const n=m.playerCards().querySelectorAll(".card"),o=m.deckViewBtn(),i=o.getBoundingClientRect();if(n.length===0){e();return}let r=0;n.forEach((c,a)=>{const d=c.getBoundingClientRect(),l=c.cloneNode(!0);l.style.position="fixed",l.style.left=`${d.left}px`,l.style.top=`${d.top}px`,l.style.width=`${d.width}px`,l.style.height=`${d.height}px`,l.style.margin="0",l.style.zIndex="3000",document.body.appendChild(l),c.style.visibility="hidden",setTimeout(()=>{l.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",l.style.left=`${i.left+i.width/2-30}px`,l.style.top=`${i.top+i.height/2-40}px`,l.style.transform="scale(0.3) rotate(360deg)",l.style.opacity="0",setTimeout(()=>{o.classList.add("absorbing"),setTimeout(()=>o.classList.remove("absorbing"),300)},400),setTimeout(()=>{l.remove(),r++,r===n.length&&e()},500)},a*100)})})}function xe(e){return new Promise(s=>{const o=m.handCards().querySelectorAll(".card"),i=m.deckViewBtn(),r=i.getBoundingClientRect();let c=0,a=0;if(o.forEach((d,l)=>{e.includes(l)||a++}),a===0){s();return}o.forEach((d,l)=>{if(!e.includes(l)){const p=d.getBoundingClientRect(),u=d.cloneNode(!0);u.classList.remove("selected"),u.style.position="fixed",u.style.left=`${p.left}px`,u.style.top=`${p.top}px`,u.style.width=`${p.width}px`,u.style.height=`${p.height}px`,u.style.margin="0",u.style.zIndex="3000",u.style.opacity="1",document.body.appendChild(u),d.style.visibility="hidden",setTimeout(()=>{u.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",u.style.left=`${r.left+r.width/2-30}px`,u.style.top=`${r.top+r.height/2-40}px`,u.style.transform="scale(0.3) rotate(360deg)",u.style.opacity="0",setTimeout(()=>{i.classList.add("absorbing"),setTimeout(()=>i.classList.remove("absorbing"),300)},400),setTimeout(()=>{u.remove(),c++,c===a&&s()},500)},l*80)}})})}function Se(){return new Promise(e=>{const n=m.playerCards().querySelectorAll(".card");if(n.length===0){e();return}let o=0;n.forEach((i,r)=>{setTimeout(()=>{i.classList.add("burning"),Me(i),o++,o===n.length&&setTimeout(e,800)},r*100)})})}function Me(e){const s=e.getBoundingClientRect();for(let n=0;n<8;n++){const o=document.createElement("div");o.className="ash-particle",o.style.position="fixed",o.style.left=`${s.left+Math.random()*s.width}px`,o.style.top=`${s.top+s.height/2+Math.random()*20}px`,o.style.animationDelay=`${Math.random()*.3}s`,document.body.appendChild(o),setTimeout(()=>o.remove(),1e3)}}function T(e){e.onApply&&e.onApply(t),t.passives.push(e)}function _(e){const s=t.passives.find(n=>n.id===e);return s&&s.onRemove&&s.onRemove(t),t.passives=t.passives.filter(n=>n.id!==e),s}function M(e=!1){if(e){const s=v.loadGameState(k,y,S);s&&(t.round=s.round,t.deck=s.deck,t.hand=s.hand,t.discardPile=s.discardPile,t.deckSize=s.deckSize,t.passives=s.passives,t.currentGimmick=s.currentGimmick,t.currentBoss=s.currentBoss,t.consecutiveWins=s.consecutiveWins,t.lastWinColors=s.lastWinColors,t.passives.forEach(n=>{n.onApply&&n.onApply(t)}))}else t.reset(),v.clearGameState();b.playBGM("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"),X()}function X(){const e=ae();if(!e.canContinue){P(!1,e.reason,M);return}const s=String(t.round),n=se.rounds[s];if(n?.boss){const o=n.boss[Math.floor(Math.random()*n.boss.length)];if(S[o]){t.currentBoss=S[o],t.currentGimmick=null,N(`âš”ï¸ ë³´ìŠ¤ ë“±ì¥: ${S[o].name}!`,"gimmick"),document.body.style.background=S[o].bgColor,x(n);return}}else t.currentBoss=null,document.body.style.background="";if(n?.gimmicks){const o=n.gimmicks[Math.floor(Math.random()*n.gimmicks.length)];o==="CLEAR"?(t.currentGimmick=null,x(n)):y[o]?(t.currentGimmick=y[o],ye(t.currentGimmick,()=>{x(n)})):x(n)}else x(n)}function x(e){if(e?.passives&&e.passives.length>0){const s=e.passives,n=t.passives.map(i=>i.id),o=s.filter(i=>k[i]&&!n.includes(i)).map(i=>k[i]);if(o.length>0){const i=w(o).slice(0,2);Ie(i,()=>{I()})}else I()}else I()}function I(){t.phase="battle",t.hand=ne(),t.enemyCards=te();const e=t.enemyCards.length;t.playerCards=new Array(e).fill(null),t.selectedHandIndices=[],z(),W(),de(),le(J),ue(we),C(),F(),m.actionBtn().onclick=Le}function we(e){const s=t.hand[e];if(s){if(t.selectedHandIndices.includes(e))K(s,e);else{const n=t.playerCards.findIndex(o=>o===null);n!==-1&&(t.selectedHandIndices.push(e),t.playerCards[n]=s)}U()}}function J(e){const s=t.hand.findIndex(o=>o&&o.id===e);if(s===-1)return;const n=t.hand[s];K(n,s),U()}function K(e,s){const n=t.playerCards.findIndex(o=>o&&o.id===e.id);n!==-1&&(t.playerCards[n]=null),t.selectedHandIndices=t.selectedHandIndices.filter(o=>o!==s)}function U(){me(),$e(),F()}function $e(){m.playerCards().querySelectorAll(".card").forEach(s=>{s.dataset.bound||(s.dataset.bound="true",s.addEventListener("click",()=>J(s.dataset.id)))})}async function Le(){const e=[...t.selectedHandIndices],s=t.currentGimmick,n=s&&s.reversedDiscard;n?await xe(e):await ke(e);const o=ie(),i={joker:"ğŸƒ ì¡°ì»¤ ë°œë™!",redMatch:"ğŸ”´ ë¶‰ì€ ì‹¬íŒ ë°œë™!",blueMatch:"ğŸ”µ í‘¸ë¥¸ ì‹¬íŒ ë°œë™!",thirdReverse:"ğŸ”„ ì—­ì „ì˜ ìš©ì‚¬ ë°œë™!",redRush:"ğŸ ë¹¨ê°„ ë§› +1!"};o.triggeredPassives?.forEach((r,c)=>{setTimeout(()=>{i[r]&&N(i[r],"passive")},c*300)}),he(o,async()=>{if(o.isVictory){n?await Se():await be();const r=oe(o);r>0?Be(r):Q()}else v.updateStatsOnGameOver(t.round,!1),v.clearGameState(),P(!1,`${t.round}ë¼ìš´ë“œì—ì„œ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.`,M)})}function Be(e){t.phase="acquire";const s=t.deckSize,n=t.deck.length,o=Math.max(0,s-n),i=Math.min(e,o);if(i<=0){R();return}if(i<=4){const r=D(i*2);V(r,i,c=>{t.deck.push(...c),t.deck=w(t.deck),R()})}else Y(i)}function Y(e){if(e<=0){R();return}const s=Math.min(4,e),n=D(8);V(n,s,o=>{t.deck.push(...o),t.deck=w(t.deck),Y(e-s)})}function R(){v.saveGameState(t),Q()}function Ee(e,s){const n=()=>{ge(e,o=>{o?t.passives.length>=3?ve(t.passives,o,i=>{_(i),T(o),C(),s()},()=>{n()}):(T(o),C(),s()):s()})};n()}function Ie(e,s){t.phase="event",Ee(e,s)}function Q(){if(t.round++,t.round>50){v.updateStatsOnGameOver(t.round,!0),v.clearGameState(),P(!0,"50ë¼ìš´ë“œë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!",M);return}v.saveGameState(t),X()}document.addEventListener("DOMContentLoaded",()=>{if(v.hasSave()){const e=confirm("ì €ì¥ëœ ê²Œì„ì„ ì´ì–´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");M(e)}else M();m.deckViewBtn().addEventListener("click",()=>{b.playSFX("cardSelect"),H()}),m.deckCloseBtn().addEventListener("click",()=>{b.playSFX("cardSelect"),j()}),m.acquireDeckBtn().addEventListener("click",H),m.deckOverlay().addEventListener("click",e=>{e.target===m.deckOverlay()&&j()})});window.cheat={state:t,passives:k,gimmicks:y,setGimmick(e){y[e]?(t.currentGimmick=y[e],W(),console.log(`âœ… ê¸°ë¯¹ ì„¤ì •: ${y[e].name}`)):console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ë¯¹:",Object.keys(y).join(", "))},addPassive(e){if(k[e]){if(t.passives.length>=3){console.log("âš ï¸ íŒ¨ì‹œë¸Œê°€ ì´ë¯¸ 3ê°œì…ë‹ˆë‹¤. ë¨¼ì € removePassiveë¡œ ì œê±°í•˜ì„¸ìš”.");return}const s=k[e];T(s),C(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì¶”ê°€: ${s.name}`)}else console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ì‹œë¸Œ:",Object.keys(k).join(", "))},removePassive(e){const s=_(e);s?(C(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì œê±°: ${s.name}`)):console.log("âŒ í˜„ì¬ íŒ¨ì‹œë¸Œ:",t.passives.map(n=>n.id).join(", "))},clearPassives(){t.passives.forEach(e=>{e.onRemove&&e.onRemove(t)}),t.passives=[],C(),console.log("âœ… ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°ë¨")},setRound(e){t.round=e,z(),console.log(`âœ… ë¼ìš´ë“œ ì„¤ì •: ${e}`)},help(){console.log(`
ğŸ® ì¹˜íŠ¸ ëª…ë ¹ì–´ ëª©ë¡:

ğŸ“‹ ìƒíƒœ ë³´ê¸°:
  cheat.state              - í˜„ì¬ ê²Œì„ ìƒíƒœ
  cheat.passives           - ëª¨ë“  íŒ¨ì‹œë¸Œ ëª©ë¡
  cheat.gimmicks           - ëª¨ë“  ê¸°ë¯¹ ëª©ë¡

âš¡ ê¸°ë¯¹ ì„¤ì •:
  cheat.setGimmick('reversal')    - ì—­ì „ì˜ ëŒ€ê°€ ê¸°ë¯¹ ì ìš©

ğŸ”® íŒ¨ì‹œë¸Œ ê´€ë¦¬:
  cheat.addPassive('bigHand')     - í° ì† íŒ¨ì‹œë¸Œ ì¶”ê°€
  cheat.removePassive('bigHand')  - í° ì† íŒ¨ì‹œë¸Œ ì œê±°
  cheat.clearPassives()           - ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°

ğŸ”¢ ë¼ìš´ë“œ:
  cheat.setRound(10)              - 10ë¼ìš´ë“œë¡œ ì„¤ì •

ğŸ“¦ ì‚¬ìš© ê°€ëŠ¥í•œ ID:
  ê¸°ë¯¹: ${Object.keys(y).join(", ")}
  íŒ¨ì‹œë¸Œ: ${Object.keys(k).join(", ")}
    `)}};console.log("ğŸ® ì¹˜íŠ¸ ì‚¬ìš©ë²•: cheat.help()");
