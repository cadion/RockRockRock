(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=i(n);fetch(n.href,c)}})();function ee(){const e=["blue","yellow","orange","purple","white"],s=["rock","paper","scissors"],i=[];for(const o of e)for(const n of s)i.push({color:o,shape:n,id:`${o}-${n}-${Date.now()}-${Math.random()}`});return $(i)}function $(e){const s=[...e];for(let i=s.length-1;i>0;i--){const o=Math.floor(Math.random()*(i+1));[s[i],s[o]]=[s[o],s[i]]}return s}const t={round:1,deck:[],hand:[],discardPile:[],passives:[],currentGimmick:null,currentBoss:null,deckSize:15,previousShapes:[],enemyCards:[],playerCards:[],selectedHandIndices:[],lostCardsThisRound:0,consecutiveWins:0,lastWinColors:[],phase:"battle",nextRoundModifier:null,reset(){this.round=1,this.deck=ee(),this.hand=[],this.discardPile=[],this.passives=[],this.currentGimmick=null,this.currentBoss=null,this.deckSize=15,this.previousShapes=[],this.enemyCards=[],this.playerCards=[],this.selectedHandIndices=[],this.lostCardsThisRound=0,this.consecutiveWins=0,this.lastWinColors=[],this.phase="battle",this.nextRoundModifier=null}},C={bigHand:{id:"bigHand",name:"í° ì†",icon:"ğŸ–ï¸",desc:"í•¸ë“œ í¬ê¸°ê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤ (6ì¥)",color:"#27ae60",tier:1,handSizeBonus:1},smallDeck:{id:"smallDeck",name:"ì••ì¶•",icon:"ğŸ“¦",desc:"ë± í¬ê¸°ê°€ 1 ê°ì†Œí•©ë‹ˆë‹¤",color:"#e67e22",tier:1,onApply:e=>{e.deckSize-=1},onRemove:e=>{e.deckSize+=1}},whiteStabilize:{id:"whiteStabilize",name:"ë°±ìƒ‰ ì•ˆì •",icon:"âšª",desc:"í°ìƒ‰ ì¹´ë“œëŠ” ì†Œë©¸ ì‹œ ë±ìœ¼ë¡œ ë³µê·€í•©ë‹ˆë‹¤",color:"#ecf0f1",tier:1},earlyBird:{id:"earlyBird",name:"ê¸°ì„  ì œì••",icon:"ğŸ¦",desc:"ì²« ë²ˆì§¸ ì¹´ë“œê°€ ë¹„ê¸¸ ê²½ìš° ìŠ¹ë¦¬ë¡œ ê°„ì£¼",color:"#f39c12",tier:1},shield:{id:"shield",name:"ë°©íŒ¨",icon:"ğŸ›¡ï¸",desc:"ì „íˆ¬ íŒ¨ë°° ì‹œ ìƒëŠ” ì¹´ë“œ ìˆ˜ -1 (ìµœì†Œ 1)",color:"#7f8c8d",tier:1},deckSizer:{id:"deckSizer",name:"ì ì • ê¸°ìˆ ",icon:"ğŸ“",desc:"ë± í¬ê¸°ê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤",color:"#16a085",tier:1,onApply:e=>{e.deckSize+=1},onRemove:e=>{e.deckSize-=1}},redMatch:{id:"redMatch",name:"ë¶‰ì€ ì‹¬íŒ",icon:"ğŸ”´",desc:"ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#e74c3c",tier:2},blueMatch:{id:"blueMatch",name:"í‘¸ë¥¸ ì‹¬íŒ",icon:"ğŸ”µ",desc:"íŒŒë€ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#3498db",tier:2},redRush:{id:"redRush",name:"ë¹¨ê°„ ë§›",icon:"ğŸ",desc:"í•„ë“œì— ë¹¨ê°„ìƒ‰ ì¹´ë“œê°€ 3ì¥ ì´ìƒì´ë©´ ìŠ¹ì  +1",color:"#c0392b",tier:2},flexibility:{id:"flexibility",name:"ìœ ì—°í•¨",icon:"ğŸŒŠ",desc:"ë³´ë¡œ ì´ê¸°ë©´ ë²„ë ¤ì§„ ì¹´ë“œ 1ì¥ ë³µêµ¬",color:"#2980b9",tier:2},recycle:{id:"recycle",name:"ì¬í™œìš©",icon:"â™»ï¸",desc:"ë²„ë ¤ì§ˆ í°ìƒ‰ ì¹´ë“œ 1ì¥ì€ ë±ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤",color:"#95a5a6",tier:2},blueShield:{id:"blueShield",name:"í‘¸ë¥¸ ë°©ë²½",icon:"ğŸ’™",desc:"í•„ë“œì— íŒŒë€ìƒ‰ 2ì¥ ì´ìƒ ì‹œ íŒ¨ë°° íŒ¨ë„í‹° -1",color:"#3498db",tier:2},greenGrowth:{id:"greenGrowth",name:"ì´ˆë¡ ì„±ì¥",icon:"ğŸŒ±",desc:"ì´ˆë¡ìƒ‰ ì¹´ë“œë¡œ ìŠ¹ë¦¬ ì‹œ ê°™ì€ ëª¨ì–‘ ì¹´ë“œ 1ì¥ íšë“",color:"#27ae60",tier:2},yellowFlash:{id:"yellowFlash",name:"í™©ê¸ˆ ë¹›",icon:"âœ¨",desc:"ë…¸ë€ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#f1c40f",tier:2},colorCollector:{id:"colorCollector",name:"ìƒ‰ì±„ ìˆ˜ì§‘ê°€",icon:"ğŸ¨",desc:"í•„ë“œì— 3ê°€ì§€ ìƒ‰ìƒ ì´ìƒ ë°°ì¹˜ ì‹œ ìŠ¹ì  +1",color:"#9b59b6",tier:2},thirdReverse:{id:"thirdReverse",name:"ì—­ì „ì˜ ìš©ì‚¬",icon:"ğŸ”„",desc:"ì„¸ ë²ˆì§¸ ì¹´ë“œëŠ” ì§€ëŠ” ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#9b59b6",tier:3},joker:{id:"joker",name:"ì¡°ì»¤",icon:"ğŸƒ",desc:"ë³´ë¼ìƒ‰ ì¹´ë“œëŠ” ë¬´ì¡°ê±´ ìŠ¹ë¦¬ (ëª¨ì–‘ ë¬´ì‹œ)",color:"#8e44ad",tier:3},monochrome:{id:"monochrome",name:"ë‹¨ìƒ‰í™”",icon:"â¬›",desc:"ë±ì— ìƒ‰ìƒì´ 2ì¢…ë¥˜ ì´í•˜ë¼ë©´ ë¹„ê¸°ëŠ” ìƒí™©ì—ì„œ ìŠ¹ë¦¬",color:"#34495e",tier:3},perfectCycle:{id:"perfectCycle",name:"ì™„ë²½í•œ ìˆœí™˜",icon:"ğŸ”",desc:"ë±ì˜ ê°€ìœ„,ë°”ìœ„,ë³´ ë¹„ìœ¨ì´ ë™ì¼í•˜ë©´ í•¸ë“œ +1",color:"#1abc9c",tier:3,handSizeBonus:0},lastStand:{id:"lastStand",name:"ìµœí›„ì˜ ì¼ê²©",icon:"âš¡",desc:"ë§ˆì§€ë§‰ ìŠ¬ë¡¯ì˜ ì¹´ë“œê°€ ë°”ìœ„ë¼ë©´ ë¬´ì¡°ê±´ ìŠ¹ë¦¬",color:"#e67e22",tier:3},rainbowMaster:{id:"rainbowMaster",name:"ë¬´ì§€ê°œ ì§€ë°°ì",icon:"ğŸŒˆ",desc:"í•„ë“œì— 5ìƒ‰ì´ ëª¨ë‘ ëª¨ì´ë©´ ë¼ìš´ë“œ ì¦‰ì‹œ ìŠ¹ë¦¬",color:"#e74c3c",tier:3}},k={twoCards:{id:"twoCards",name:"ê°€ë²¼ìš´ ì „íˆ¬",desc:"ì ì´ íŒ¨ë¥¼ 2ê°œë§Œ ëƒ…ë‹ˆë‹¤",tier:1,enemyCardCount:2},greenOnly:{id:"greenOnly",name:"ì´ˆë¡ ì „ì—¼ë³‘",desc:"ì ì´ ì´ˆë¡ìƒ‰ íŒ¨ë§Œ ëƒ…ë‹ˆë‹¤",tier:1,enemyColor:"green"},scissorsOnly:{id:"scissorsOnly",name:"ê°€ìœ„ ë°”ëŒ",desc:"ì ì´ ê°€ìœ„ë§Œ ëƒ…ë‹ˆë‹¤",tier:1,enemyShape:"scissors"},fog:{id:"fog",name:"ì•ˆê°œ",desc:"ì ì˜ ê°€ìš´ë° íŒ¨ê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:1,hiddenIndex:1},static:{id:"static",name:"ì •ì „ê¸°",desc:"í•„ë“œì— ë†“ì€ ì¹´ë“œë¥¼ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",tier:1,cannotDeselect:!0},haste:{id:"haste",name:"ì‹ ì†",desc:"ì œì¶œ ì „ê¹Œì§€ ì ì˜ ì¹´ë“œê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:1,hideAllEnemyCards:!0},heavy:{id:"heavy",name:"ë¬´ê±°ìš´ ì§",desc:"í•¸ë“œ ë“œë¡œìš° ì‹œ 1ì¥ì„ ëœ ë½‘ìŠµë‹ˆë‹¤",tier:1,drawPenalty:1},fourCards:{id:"fourCards",name:"4ì—°íƒ€",desc:"ì ì´ íŒ¨ë¥¼ 4ê°œ ëƒ…ë‹ˆë‹¤",tier:2,enemyCardCount:4},mimic:{id:"mimic",name:"ëª¨ë°©",desc:"ì ì˜ ì²« ë²ˆì§¸ íŒ¨ê°€ ë‹¹ì‹ ì˜ ì„ íƒì„ ë”°ë¼í•©ë‹ˆë‹¤",tier:2,mimicFirst:!0},corrosion:{id:"corrosion",name:"ë¶€ì‹",desc:"ì´ë²ˆ ë¼ìš´ë“œ, ë°”ìœ„ëŠ” ê°€ìœ„ì—ê²Œ ì§‘ë‹ˆë‹¤",tier:2,rockLosesToScissors:!0},reversal:{id:"reversal",name:"ì—­ì „ì˜ ëŒ€ê°€",desc:"í•¸ë“œ ì¹´ë“œëŠ” ë±ìœ¼ë¡œ, í•„ë“œ ì¹´ë“œëŠ” ì†Œë©¸í•©ë‹ˆë‹¤",tier:2,reversedDiscard:!0},purpleAcquire:{id:"purpleAcquire",name:"ë³´ë¼ìƒ‰í­í’",desc:"ì¹´ë“œ íšë“ ì‹œ ë³´ë¼ìƒ‰ë§Œ ë“±ì¥í•©ë‹ˆë‹¤",tier:2,acquireColor:"purple"},scissorsAcquire:{id:"scissorsAcquire",name:"ê°€ìœ„ ì„¸ë¡€",desc:"ì¹´ë“œ íšë“ ì‹œ ê°€ìœ„ë§Œ ë“±ì¥í•©ë‹ˆë‹¤",tier:2,acquireShape:"scissors"},gravity:{id:"gravity",name:"ì¤‘ë ¥",desc:"íŠ¹ì • ìƒ‰ìƒì˜ ì¹´ë“œë¥¼ ì´ë²ˆ ë¼ìš´ë“œì— ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",tier:2,bannedColor:null},chaosAcquire:{id:"chaosAcquire",name:"í˜¼ëˆì˜ íšë“",desc:"ì¹´ë“œ íšë“ ì‹œ ì„ íƒì§€ ì—†ì´ ë¬´ì‘ìœ„ íšë“",tier:2,randomAcquire:!0},blindSide:{id:"blindSide",name:"ì‚¬ê°ì§€ëŒ€",desc:"í™€ìˆ˜ ë²ˆì§¸ ì ì˜ ì¹´ë“œê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:2,hideOddCards:!0},overload:{id:"overload",name:"í­ì£¼",desc:"ì ì´ íŒ¨ë¥¼ 5ê°œ ëƒ…ë‹ˆë‹¤! (í•¸ë“œ ì „ë¶€ ì‚¬ìš©)",tier:3,enemyCardCount:5},passiveNull:{id:"passiveNull",name:"ì¹¨ë¬µ",desc:"ëª¨ë“  íŒ¨ì‹œë¸Œ íš¨ê³¼ê°€ ì´ë²ˆ ë¼ìš´ë“œì— ë°œë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤",tier:3,disablePassives:!0},colorCurse:{id:"colorCurse",name:"ìƒ‰ìƒ ì €ì£¼",desc:"íŠ¹ì • ìƒ‰ìƒ ì¹´ë“œë¡œ íŒ¨ë°° ì‹œ í•´ë‹¹ ì¹´ë“œ ì˜êµ¬ ì‚­ì œ",tier:3,cursedColor:null},echo:{id:"echo",name:"ë©”ì•„ë¦¬",desc:"ì ì´ í”Œë ˆì´ì–´ì˜ ì§€ë‚œ ë¼ìš´ë“œ ëª¨ì–‘ì„ ê·¸ëŒ€ë¡œ ëƒ…ë‹ˆë‹¤",tier:3,usePreviousShapes:!0},dimensionShift:{id:"dimensionShift",name:"ì°¨ì› ì „ì´",desc:"ìƒì„± ê´€ê³„ê°€ ë°˜ëŒ€ë¡œ ë°”ë€ë‹ˆë‹¤ (ë³´ > ê°€ìœ„ > ë°”ìœ„ > ë³´)",tier:3,reverseRPS:!0}},x={guardian:{id:"guardian",name:"ìˆ˜í˜¸ì",desc:"6ì¥ì˜ ì¹´ë“œë¡œ ë‹¹ì‹ ì„ ì••ë°•í•©ë‹ˆë‹¤",cardCount:6,bgColor:"#1a0a0a",reward:"rare_passive"},chaos:{id:"chaos",name:"í˜¼ëˆì˜ êµ°ì£¼",desc:"7ì¥ì˜ ì¹´ë“œì™€ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ íŒ¨í„´",cardCount:7,bgColor:"#0a0a1a",reward:"deck_purge"},mirror:{id:"mirror",name:"ê±°ìš¸ì˜ ë§ˆë…€",desc:"ë‹¹ì‹ ì˜ ëª¨ì–‘ì„ ê·¸ëŒ€ë¡œ ë”°ë¼í•©ë‹ˆë‹¤",cardCount:5,mimicAll:!0,bgColor:"#0a1a0a",reward:"rare_passive"}},se={1:{passives:[]},4:{passives:["redMatch","blueMatch","bigHand","smallDeck"]},7:{gimmicks:["fourCards","twoCards"],passives:["thirdReverse","redRush","flexibility"]},10:{boss:["guardian"],gimmicks:["fog","mimic","greenOnly"],passives:["recycle","joker","bigHand"]},14:{gimmicks:["corrosion","overload","scissorsOnly"],passives:["smallDeck","redMatch","blueMatch"]},17:{gimmicks:["reversal","purpleAcquire","scissorsAcquire"],passives:["joker","thirdReverse","flexibility"]},20:{boss:["chaos","guardian"],gimmicks:["CLEAR"],passives:["recycle","flexibility","thirdReverse"]},24:{gimmicks:["overload","reversal"],passives:["bigHand","smallDeck","recycle"]},27:{gimmicks:["fog","corrosion","mimic"],passives:["joker","redRush","flexibility"]},30:{boss:["mirror","chaos","guardian"],passives:["joker","bigHand","smallDeck","recycle"]},34:{gimmicks:["overload","reversal","purpleAcquire"],passives:["thirdReverse","redMatch","blueMatch"]},37:{gimmicks:["scissorsAcquire","greenOnly","fog"],passives:["recycle","flexibility","bigHand"]},40:{boss:["mirror","chaos"],passives:["joker","smallDeck","redRush"]}},te={rounds:se},T={rock:"âœŠ",paper:"âœ‹",scissors:"âœŒï¸"};function ie(){const e=t.currentGimmick,s=t.currentBoss,i=t.nextRoundModifier;let o=3;s&&s.cardCount?o=s.cardCount:e&&e.enemyCardCount&&(o=e.enemyCardCount),i&&i.enemyCardBonus&&(o=Math.max(2,o+i.enemyCardBonus)),t.nextRoundModifier=null;const n=["rock","paper","scissors"],c=["blue","yellow","orange","purple","white","green"],r=[];if(e&&e.usePreviousShapes&&t.previousShapes.length>0){for(let a=0;a<Math.min(o,t.previousShapes.length);a++){const l=c[Math.floor(Math.random()*c.length)];r.push({color:l,shape:t.previousShapes[a],id:`enemy-${a}-${Date.now()}`,hidden:!1})}for(;r.length<o;){const a=n[Math.floor(Math.random()*n.length)],l=c[Math.floor(Math.random()*c.length)];r.push({color:l,shape:a,id:`enemy-${r.length}-${Date.now()}`,hidden:!1})}return r}for(let a=0;a<o;a++){let l=n[Math.floor(Math.random()*n.length)],d=c[Math.floor(Math.random()*c.length)];e&&e.enemyShape&&(l=e.enemyShape),e&&e.enemyColor&&(d=e.enemyColor);let h=!1;e&&e.hiddenIndex===a&&(h=!0),e&&e.hideAllEnemyCards&&(h=!0),e&&e.hideOddCards&&a%2===0&&(h=!0),r.push({color:d,shape:l,id:`enemy-${a}-${Date.now()}`,hidden:h})}return r}function ne(){const e=t.deck;if(e.length===0)return[];const s=t.currentGimmick,i=t.passives,o=t.deckSize;let n=i.reduce((h,u)=>h+(u.handSizeBonus||0),0);if(i.some(h=>h.id==="perfectCycle")){const h=e.filter(f=>f.shape==="rock").length,u=e.filter(f=>f.shape==="paper").length,g=e.filter(f=>f.shape==="scissors").length;h===u&&u===g&&h>0&&(n+=1)}const c=e.length;let r=0;s&&s.drawPenalty&&(r=s.drawPenalty);const a=Math.max(1,5+n-r),l=Math.min(Math.max(a,o-(c-a)),c,a);return e.splice(0,l)}function L(e,s,i=null){return i&&i.reverseRPS?e===s?0:e==="paper"&&s==="scissors"||e==="scissors"&&s==="rock"||e==="rock"&&s==="paper"?1:-1:e===s?0:e==="rock"&&s==="scissors"||e==="paper"&&s==="rock"||e==="scissors"&&s==="paper"?1:-1}function A(e,s,i,o){const n=t.passives,c=t.currentGimmick,r=c&&c.disablePassives;if(!r&&n.some(l=>l.id==="lastStand")&&i===o-1&&e.shape==="rock")return{result:1,reason:"ìµœí›„ì˜ ì¼ê²©!",passiveTriggered:"lastStand"};if(!r&&n.some(l=>l.id==="joker")&&e.color==="purple")return{result:1,reason:"ì¡°ì»¤ ë°œë™!",passiveTriggered:"joker"};if(c&&c.rockLosesToScissors&&e.shape==="rock"&&s.shape==="scissors")return{result:-1,reason:"ë¶€ì‹! ë°”ìœ„ê°€ ë¬´ë ¥í™”ë¨",gimmickTriggered:"corrosion"};if(e.shape===s.shape){if(!r&&n.some(l=>l.id==="redMatch")&&e.color==="orange")return{result:1,reason:"ë¶‰ì€ ì‹¬íŒ!",passiveTriggered:"redMatch"};if(!r&&n.some(l=>l.id==="blueMatch")&&e.color==="blue")return{result:1,reason:"í‘¸ë¥¸ ì‹¬íŒ!",passiveTriggered:"blueMatch"};if(!r&&n.some(l=>l.id==="yellowFlash")&&e.color==="yellow")return{result:1,reason:"í™©ê¸ˆ ë¹›!",passiveTriggered:"yellowFlash"}}return!r&&n.some(l=>l.id==="thirdReverse")&&i===2&&L(e.shape,s.shape,c)===-1?{result:1,reason:"ì—­ì „!",passiveTriggered:"thirdReverse"}:!r&&n.some(l=>l.id==="earlyBird")&&i===0&&L(e.shape,s.shape,c)===0?{result:1,reason:"ê¸°ì„  ì œì••!",passiveTriggered:"earlyBird"}:!r&&n.some(l=>l.id==="monochrome")&&new Set(t.deck.map(d=>d.color)).size<=2&&L(e.shape,s.shape,c)===0?{result:1,reason:"ë‹¨ìƒ‰í™”!",passiveTriggered:"monochrome"}:{result:L(e.shape,s.shape,c),reason:null}}function oe(){const e=t.playerCards,s=t.enemyCards,i=t.currentGimmick,o=t.passives,n=i&&i.disablePassives;if(i&&i.mimicFirst&&e.length>0&&(s[0]={...s[0],shape:e[0].shape,mimicked:!0}),!n&&o.some(f=>f.id==="rainbowMaster")&&new Set(e.filter(v=>v!==null).map(v=>v.color)).size>=5)return{results:e.map(()=>({result:1,reason:"ë¬´ì§€ê°œ ì§€ë°°ì!",passiveTriggered:"rainbowMaster"})),wins:s.length,losses:0,draws:0,bonusWins:0,totalWins:s.length,isVictory:!0,triggeredPassives:["rainbowMaster"]};let c=0,r=0,a=0;const l=[];t.previousShapes=e.filter(f=>f!==null).map(f=>f.shape);for(let f=0;f<s.length;f++){const v=e[f],G=s[f];if(!v){l.push({result:-1,reason:"ì¹´ë“œ ì—†ìŒ"}),r++;continue}const I=A(v,G,f,s.length);l.push(I),I.result===1?c++:I.result===-1?r++:a++}let d=0;!n&&o.some(f=>f.id==="redRush")&&e.filter(v=>v&&v.color==="orange").length>=3&&(d=1),!n&&o.some(f=>f.id==="colorCollector")&&new Set(e.filter(v=>v!==null).map(v=>v.color)).size>=3&&(d+=1);const h=[];l.forEach((f,v)=>{f.passiveTriggered&&!h.includes(f.passiveTriggered)&&h.push(f.passiveTriggered)}),d>0&&(!n&&o.some(f=>f.id==="redRush")&&h.push("redRush"),!n&&o.some(f=>f.id==="colorCollector")&&h.push("colorCollector"));const u=c+d,g=u>r;return{results:l,wins:c,losses:r,draws:a,bonusWins:d,totalWins:u,isVictory:g,triggeredPassives:h}}function re(e){const s=t.passives,i=t.currentGimmick,o=i&&i.reversedDiscard,n=t.hand.filter((r,a)=>!t.selectedHandIndices.includes(a));let c=0;if(o){let r=[...t.playerCards.filter(a=>a!==null)];if(s.some(a=>a.id==="recycle")){const a=r.findIndex(l=>l.color==="white");if(a!==-1){const l=r.splice(a,1)[0];t.deck.push(l)}}s.some(a=>a.id==="whiteStabilize")&&r.filter(l=>l.color==="white").forEach(l=>{const d=r.indexOf(l);d!==-1&&(r.splice(d,1),t.deck.push(l))}),t.deck.push(...n),t.discardPile.push(...r),c=r.length}else{let r=[...n];if(s.some(a=>a.id==="recycle")){const a=r.findIndex(l=>l.color==="white");if(a!==-1){const l=r.splice(a,1)[0];t.deck.push(l)}}s.some(a=>a.id==="whiteStabilize")&&r.filter(l=>l.color==="white").forEach(l=>{const d=r.indexOf(l);d!==-1&&(r.splice(d,1),t.deck.push(l))}),t.discardPile.push(...r),c=r.length,t.deck.push(...t.playerCards.filter(a=>a!==null))}if(!e.isVictory&&s.some(r=>r.id==="shield")&&(c=Math.max(1,c-1)),!e.isVictory&&s.some(r=>r.id==="blueShield")&&t.playerCards.filter(a=>a&&a.color==="blue").length>=2&&(c=Math.max(1,c-1)),t.deck=$(t.deck),t.hand=[],s.some(r=>r.id==="flexibility")){for(let r=0;r<e.results.length;r++)if(e.results[r].result===1&&t.playerCards[r]?.shape==="paper"){if(t.discardPile.length>0){const a=t.discardPile.pop();t.deck.push(a)}break}}if(s.some(r=>r.id==="greenGrowth")){for(let r=0;r<e.results.length;r++)if(e.results[r].result===1&&t.playerCards[r]?.color==="green"){const l={color:"green",shape:t.playerCards[r].shape,id:`grow-${Date.now()}-${Math.random()}`};t.deck.push(l);break}}if(!e.isVictory&&i&&i.colorCurse){const r=i.cursedColor;if(r){for(let a=0;a<e.results.length;a++)if(e.results[a].result===-1&&t.playerCards[a]?.color===r){const l=t.playerCards[a],d=t.deck.findIndex(h=>h.id===l.id);d!==-1&&t.deck.splice(d,1)}}}return t.lostCardsThisRound=c,t.playerCards=[],t.selectedHandIndices=[],c}function z(e){const s=t.currentGimmick;let i=["blue","yellow","orange","purple","white"],o=["rock","paper","scissors"];s?.acquireColor&&(i=[s.acquireColor]),s?.acquireShape&&(o=[s.acquireShape]);const n=[];for(let c=0;c<e;c++){const r=i[Math.floor(Math.random()*i.length)],a=o[Math.floor(Math.random()*o.length)];let l=null;const d=Math.random();d<.05?l="cursed":d<.15&&(l="gold"),n.push({color:r,shape:a,id:`acq-${c}-${Date.now()}-${Math.random()}`,special:l})}return n}function ae(){const e=t.deck.length;return e<5?{canContinue:!1,reason:`ë±ì— ì¹´ë“œê°€ ${e}ì¥ë°–ì— ë‚¨ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!`}:{canContinue:!0}}class ce{constructor(){this.bgm=null,this.sfxVolume=.5,this.bgmVolume=.3,this.isMuted=!1,this.sounds={cardSelect:"https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3",clash:"https://assets.mixkit.co/active_storage/sfx/1633/1633-preview.mp3",win:"https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3",lose:"https://assets.mixkit.co/active_storage/sfx/270/270-preview.mp3",draw:"https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"}}playSFX(s){if(this.isMuted||!this.sounds[s])return;const i=new Audio(this.sounds[s]);i.volume=this.sfxVolume,i.play().catch(o=>console.warn("Audio play failed:",o))}playBGM(s,i=!0){this.bgm&&this.bgm.pause(),this.bgm=new Audio(s),this.bgm.volume=this.bgmVolume,this.bgm.loop=i,this.bgm.play().catch(o=>console.warn("BGM play failed:",o))}setMute(s){this.isMuted=s,this.bgm&&(this.bgm.muted=s)}toggleMute(){return this.setMute(!this.isMuted),this.isMuted}}const b=new ce,B="rps_roguelike_save",H="rps_roguelike_stats";class le{constructor(){this.stats=this.loadStats()}saveGameState(s){try{const i={round:s.round,deck:s.deck,hand:s.hand,discardPile:s.discardPile,deckSize:s.deckSize,passiveIds:s.passives.map(o=>o.id),currentGimmickId:s.currentGimmick?.id||null,currentBossId:s.currentBoss?.id||null,consecutiveWins:s.consecutiveWins,lastWinColors:s.lastWinColors,timestamp:Date.now()};return localStorage.setItem(B,JSON.stringify(i)),!0}catch(i){return console.warn("ì„¸ì´ë¸Œ ì‹¤íŒ¨:",i),!1}}loadGameState(s,i,o){try{const n=localStorage.getItem(B);if(!n)return null;const c=JSON.parse(n),r=c.passiveIds.map(d=>s[d]).filter(d=>d!==void 0),a=c.currentGimmickId?i[c.currentGimmickId]:null,l=c.currentBossId?o[c.currentBossId]:null;return{...c,passives:r,currentGimmick:a,currentBoss:l}}catch(n){return console.warn("ë¡œë“œ ì‹¤íŒ¨:",n),null}}clearGameState(){localStorage.removeItem(B)}hasSave(){return localStorage.getItem(B)!==null}loadStats(){try{const s=localStorage.getItem(H);return s?JSON.parse(s):{bestRound:0,totalGames:0,totalVictories:0}}catch(s){return console.warn("í†µê³„ ë¡œë“œ ì‹¤íŒ¨:",s),{bestRound:0,totalGames:0,totalVictories:0}}}saveStats(s){try{localStorage.setItem(H,JSON.stringify(s))}catch(i){console.warn("í†µê³„ ì €ì¥ ì‹¤íŒ¨:",i)}}updateStatsOnGameOver(s,i){this.stats.totalGames++,i&&this.stats.totalVictories++,s>this.stats.bestRound&&(this.stats.bestRound=s),this.saveStats(this.stats)}getBestRound(){return this.stats.bestRound}}const y=new le,p=e=>document.querySelector(e),m={roundNum:()=>p("#round-num"),deckCount:()=>p("#deck-count"),gimmickDisplay:()=>p("#gimmick-display"),gimmickText:()=>p("#gimmick-text"),enemyCards:()=>p("#enemy-cards"),playerCards:()=>p("#player-cards"),handCards:()=>p("#hand-cards"),actionBtn:()=>p("#action-btn"),passiveList:()=>p("#passive-list"),battleResult:()=>p("#battle-result"),resultText:()=>p("#result-text"),acquireModal:()=>p("#acquire-modal"),acquireInfo:()=>p("#acquire-info"),acquireCards:()=>p("#acquire-cards"),acquireBtn:()=>p("#acquire-btn"),eventModal:()=>p("#event-modal"),eventPassives:()=>p("#event-passives"),eventSkipBtn:()=>p("#event-skip-btn"),gameoverTitle:()=>p("#gameover-title"),gameoverText:()=>p("#gameover-text"),restartBtn:()=>p("#restart-btn"),gimmickAnnounceText:()=>p("#gimmick-announce-text"),gimmickOkBtn:()=>p("#gimmick-ok-btn"),deckTotalCount:()=>p("#deck-total-count"),deckCardList:()=>p("#deck-card-list"),statRock:()=>p("#stat-rock"),statPaper:()=>p("#stat-paper"),statScissors:()=>p("#stat-scissors"),battleLog:()=>p("#battle-log"),branchModal:()=>p("#branch-modal"),branchOptions:()=>p("#branch-options"),acquireModal:()=>p("#acquire-modal"),eventModal:()=>p("#event-modal"),gameoverModal:()=>p("#gameover-modal"),gimmickModal:()=>p("#gimmick-modal"),actionBtn:()=>p("#action-btn"),deckViewBtn:()=>p("#deck-view-btn"),deckCloseBtn:()=>p("#deck-close-btn"),acquireDeckBtn:()=>p("#acquire-deck-btn"),acquireBtn:()=>p("#acquire-btn"),bgmToggleBtn:()=>p("#bgm-toggle"),deckOverlay:()=>p("#deck-overlay")};function N(e,s="passive"){const i=m.battleLog(),o=document.createElement("div");o.className=`log-message ${s}`,o.textContent=e,i.appendChild(o),setTimeout(()=>{o.parentNode&&o.remove()},2e3)}function F(){m.roundNum().textContent=t.round;const e=t.deck.length+t.hand.length;m.deckCount().textContent=e;const s=[...t.deck,...t.hand],i=s.filter(d=>d.shape==="scissors").length,o=s.filter(d=>d.shape==="rock").length,n=s.filter(d=>d.shape==="paper").length,c=p("#scissors-count span"),r=p("#rock-count span"),a=p("#paper-count span");c&&(c.textContent=i),r&&(r.textContent=o),a&&(a.textContent=n);const l=p(".best-info span");if(l){const d=y.getBestRound();l.textContent=d>0?d:"-"}}function W(){const e=m.gimmickDisplay(),s=m.gimmickText();t.currentGimmick?(e.classList.remove("hidden"),s.textContent=t.currentGimmick.desc):e.classList.add("hidden")}function E(e,s={}){const{isEnemy:i=!1,isPlaced:o=!1,isSelected:n=!1,showResult:c=!1,result:r=null,index:a=-1,slotNumber:l=null}=s,d=["card",e.color];i&&d.push("enemy-card"),o&&d.push("placed"),n&&d.push("selected"),e.hidden&&d.push("hidden-card"),e.special&&d.push(`special-${e.special}`);let h="";c&&r!==null&&(h=`<div class="result-badge ${r===1?"win":r===-1?"lose":"draw"}">${r===1?"âœ“":r===-1?"âœ—":"âˆ’"}</div>`);let u="";l!==null&&(u=`<div class="slot-badge">${l}</div>`);let g="";e.special==="gold"?g='<div class="special-badge gold">âœ¨</div>':e.special==="cursed"&&(g='<div class="special-badge cursed">ğŸ’€</div>');const f=e.hidden?"?":T[e.shape];return`
    <div class="${d.join(" ")}" data-id="${e.id}" data-index="${a}">
      <span class="shape">${f}</span>
      ${h}
      ${u}
      ${g}
    </div>
  `}function de(){const e=m.enemyCards();e.innerHTML=t.enemyCards.map((s,i)=>E(s,{isEnemy:!0,index:i})).join("")}function ue(e){const s=m.playerCards(),i=t.enemyCards.length;let o="";for(let n=0;n<i;n++){const c=t.playerCards[n],r=t.enemyCards[n];if(c){let a=null;r&&!r.hidden&&(a=A(c,r,n,i).result),o+=E(c,{isPlaced:!0,index:n,showResult:a!==null,result:a})}else o+=`<div class="card-slot">${n+1}</div>`}s.innerHTML=o,e&&s.querySelectorAll(".card").forEach(n=>{const c=n.dataset.id;n.addEventListener("click",()=>e(c))})}function me(e){const s=m.handCards();s.innerHTML=t.hand.map((i,o)=>{const n=t.selectedHandIndices.includes(o);let c=null;if(n){const r=t.playerCards.findIndex(a=>a&&a.id===i.id);r!==-1&&(c=r+1)}return E(i,{isSelected:n,index:o,slotNumber:c})}).join(""),s.querySelectorAll(".card").forEach((i,o)=>{i.addEventListener("click",()=>{b.playSFX("cardSelect"),e(o)})})}function he(){const e=m.handCards(),s=m.playerCards();e.querySelectorAll(".card").forEach((n,c)=>{const r=t.selectedHandIndices.includes(c);r?n.classList.add("selected"):n.classList.remove("selected");let a=n.querySelector(".slot-badge");if(r){const d=t.playerCards.findIndex(h=>h&&h.id===t.hand[c].id)+1;if(a)a.textContent=d;else{const h=document.createElement("div");h.className="slot-badge",h.textContent=d,n.appendChild(h)}}else a&&a.remove()}),s.querySelectorAll(".card-slot, .card").forEach((n,c)=>{const r=t.playerCards[c],a=t.enemyCards[c];if(r){if(n.classList.contains("card-slot")){const l=document.createElement("div");l.className=`card ${r.color} placed`,r.special&&l.classList.add(`special-${r.special}`),l.dataset.id=r.id;let d="";if(a&&!a.hidden){const h=A(r,a,c,t.enemyCards.length),u=h.result===1?"win":h.result===-1?"lose":"draw",g=h.result===1?"âœ“":h.result===-1?"âœ—":"âˆ’";d=`<div class="result-badge ${u}">${g}</div>`}l.innerHTML=`<span class="shape">${T[r.shape]}</span>${d}`,n.replaceWith(l)}}else if(!n.classList.contains("card-slot")){const l=document.createElement("div");l.className="card-slot",l.innerHTML='<span class="slot-num">'+(c+1)+"</span>",n.replaceWith(l)}})}function V(){const e=m.actionBtn(),s=t.enemyCards.length,i=t.playerCards.filter(o=>o!==null).length;i===s?(e.disabled=!1,e.textContent="ì œì¶œí•˜ê¸°!"):(e.disabled=!0,e.textContent=`ì¹´ë“œ ì„ íƒ (${i}/${s})`)}function S(){const e=m.passiveList();if(t.passives.length===0){e.innerHTML='<span style="color: var(--text-secondary); font-size: 12px;">íŒ¨ì‹œë¸Œ ì—†ìŒ</span>';return}e.innerHTML=t.passives.map(s=>`
    <div class="passive-emblem" style="background: ${s.color};">
      ${s.icon}
      <div class="passive-tooltip">${s.name}: ${s.desc}</div>
    </div>
  `).join("")}function pe(e,s){const i=m.battleResult(),o=m.resultText(),n=m.playerCards().querySelectorAll(".card"),c=m.enemyCards().querySelectorAll(".card");if(e.results.forEach((a,l)=>{const d=n[l],h=c[l];if(d){const u=a.result===1?"win":a.result===-1?"lose":"draw",g=a.result===1?"âœ“":a.result===-1?"âœ—":"âˆ’";d.insertAdjacentHTML("beforeend",`<div class="result-badge ${u} pop-in">${g}</div>`)}if(h){const u=a.result===1?"lose":a.result===-1?"win":"draw",g=a.result===1?"âœ—":a.result===-1?"âœ“":"âˆ’";h.insertAdjacentHTML("beforeend",`<div class="result-badge ${u} pop-in">${g}</div>`)}}),t.currentGimmick?.mimicFirst&&t.enemyCards[0]?.mimicked){const a=c[0];a&&(a.querySelector(".shape").textContent=T[t.enemyCards[0].shape])}i.classList.remove("hidden","win","lose");let r="";e.isVictory?(i.classList.add("win"),r=`ğŸ‰ ìŠ¹ë¦¬! (${e.totalWins}ìŠ¹ ${e.losses}íŒ¨)`,e.bonusWins>0&&(r+=` [ë¹¨ê°„ ë§› +${e.bonusWins}]`),b.playSFX("win"),fe()):(i.classList.add("lose"),r=`ğŸ’€ íŒ¨ë°°... (${e.wins}ìŠ¹ ${e.losses}íŒ¨)`,b.playSFX("lose"),ge()),o.textContent=r,setTimeout(()=>{i.classList.add("hidden"),s()},2e3)}function fe(){typeof confetti=="function"&&confetti({particleCount:150,spread:70,origin:{y:.6},colors:["#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ffffff"]})}function ge(){const e=p("#game-container");e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake")},500)}function _(e,s,i){const o=m.acquireModal(),n=m.acquireInfo(),c=m.acquireCards(),r=m.acquireBtn();n.textContent=`${e.length}ì¥ ì¤‘ ${s}ì¥ì„ ì„ íƒí•˜ì„¸ìš”`;let a=[];c.innerHTML=e.map((h,u)=>E(h,{isSelected:!1,index:u})).join(""),c.querySelectorAll(".card").forEach((h,u)=>{h.addEventListener("click",()=>{a.includes(u)?(a=a.filter(g=>g!==u),h.classList.remove("selected")):a.length<s&&(a.push(u),h.classList.add("selected")),r.disabled=a.length!==s})}),r.disabled=!0,o.classList.remove("hidden");const d=()=>{r.removeEventListener("click",d),o.classList.add("hidden");const h=a.map(u=>e[u]);i(h)};r.addEventListener("click",d)}function ve(e,s){const i=m.eventModal(),o=m.eventPassives(),n=m.eventSkipBtn();let c=null;const r=()=>{o.innerHTML=e.map(l=>`
      <div class="passive-choice ${c===l.id?"selected":""}" data-id="${l.id}">
        <span class="icon">${l.icon}</span>
        <span class="name">${l.name}</span>
        <span class="desc">${l.desc}</span>
      </div>
    `).join(""),o.querySelectorAll(".passive-choice").forEach(l=>{l.addEventListener("click",()=>{c=l.dataset.id,r(),a();const d=e.find(h=>h.id===c);s(d)})})},a=()=>{i.classList.add("hidden")};n.onclick=()=>{a(),s(null)},r(),i.classList.remove("hidden")}function ye(e,s,i,o){const n=m.eventModal(),c=m.eventPassives(),r=m.eventSkipBtn();r.textContent="ì´ì „ìœ¼ë¡œ",r.style.display="",c.innerHTML=`
    <p style="margin-bottom: 16px;">êµì²´í•  íŒ¨ì‹œë¸Œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
    <p style="margin-bottom: 16px; font-size: 14px; color: var(--text-secondary);">ìƒˆ íŒ¨ì‹œë¸Œ: ${s.icon} ${s.name}</p>
    ${e.map(a=>`
      <div class="passive-choice" data-id="${a.id}">
        <span class="icon">${a.icon}</span>
        <span class="name">${a.name}</span>
        <span class="desc">${a.desc}</span>
      </div>
    `).join("")}
  `,c.querySelectorAll(".passive-choice").forEach(a=>{a.addEventListener("click",()=>{n.classList.add("hidden"),r.textContent="ê±´ë„ˆë›°ê¸°",i(a.dataset.id)})}),r.onclick=()=>{n.classList.add("hidden"),r.textContent="ê±´ë„ˆë›°ê¸°",o&&o()},n.classList.remove("hidden")}function O(e,s,i){const o=m.gameoverModal(),n=m.gameoverTitle(),c=m.gameoverText(),r=m.restartBtn();n.textContent=e?"ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤!":"ğŸ’€ ê²Œì„ ì˜¤ë²„",n.style.color=e?"var(--success)":"var(--danger)",c.textContent=s,o.classList.remove("hidden"),r.onclick=()=>{o.classList.add("hidden"),i()}}function ke(e,s){const i=m.gimmickModal(),o=m.gimmickAnnounceText(),n=m.gimmickOkBtn();o.textContent=e.desc,i.classList.remove("hidden"),n.onclick=()=>{i.classList.add("hidden"),s()}}function D(){const e=m.deckOverlay(),s=m.deckTotalCount(),i=m.deckCardList(),o=t.discardPile.map(u=>u.id),n=[...t.deck,...t.hand].filter(u=>!o.includes(u.id)),c=t.hand.map(u=>u.id);s.textContent=n.length;const r=["blue","yellow","orange","purple","white"],a=["rock","paper","scissors"];n.sort((u,g)=>{const f=r.indexOf(u.color)-r.indexOf(g.color);return f!==0?f:a.indexOf(u.shape)-a.indexOf(g.shape)}),i.innerHTML=n.map(u=>{const g=c.includes(u.id),f=["card",u.color];return g&&f.push("in-hand"),`
            <div class="${f.join(" ")}" data-id="${u.id}">
                <span class="shape">${T[u.shape]}</span>
            </div>
        `}).join("");const l=n.filter(u=>u.shape==="rock").length,d=n.filter(u=>u.shape==="paper").length,h=n.filter(u=>u.shape==="scissors").length;m.statRock().textContent=l,m.statPaper().textContent=d,m.statScissors().textContent=h,e.classList.remove("hidden")}function j(){m.deckOverlay().classList.add("hidden")}function Ce(e){return new Promise(s=>{const o=m.handCards().querySelectorAll(".card");let n=0,c=0;o.forEach((r,a)=>{e.includes(a)||(c++,setTimeout(()=>{r.classList.add("burning"),be(r),n++,n===c&&setTimeout(s,800)},a*100))}),c===0&&s()})}function be(e){const s=e.getBoundingClientRect(),i=e.parentElement;for(let o=0;o<8;o++){const n=document.createElement("div");n.className="ash-particle",n.style.left=`${s.left-i.getBoundingClientRect().left+Math.random()*60}px`,n.style.top=`${s.top-i.getBoundingClientRect().top+40+Math.random()*20}px`,n.style.animationDelay=`${Math.random()*.3}s`,i.appendChild(n),setTimeout(()=>n.remove(),1e3)}}function Se(){return new Promise(e=>{const i=m.playerCards().querySelectorAll(".card"),o=m.deckViewBtn(),n=o.getBoundingClientRect();if(i.length===0){e();return}let c=0;i.forEach((r,a)=>{const l=r.getBoundingClientRect(),d=r.cloneNode(!0);d.style.position="fixed",d.style.left=`${l.left}px`,d.style.top=`${l.top}px`,d.style.width=`${l.width}px`,d.style.height=`${l.height}px`,d.style.margin="0",d.style.zIndex="3000",document.body.appendChild(d),r.style.visibility="hidden",setTimeout(()=>{d.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",d.style.left=`${n.left+n.width/2-30}px`,d.style.top=`${n.top+n.height/2-40}px`,d.style.transform="scale(0.3) rotate(360deg)",d.style.opacity="0",setTimeout(()=>{o.classList.add("absorbing"),setTimeout(()=>o.classList.remove("absorbing"),300)},400),setTimeout(()=>{d.remove(),c++,c===i.length&&e()},500)},a*100)})})}function we(e){return new Promise(s=>{const o=m.handCards().querySelectorAll(".card"),n=m.deckViewBtn(),c=n.getBoundingClientRect();let r=0,a=0;if(o.forEach((l,d)=>{e.includes(d)||a++}),a===0){s();return}o.forEach((l,d)=>{if(!e.includes(d)){const h=l.getBoundingClientRect(),u=l.cloneNode(!0);u.classList.remove("selected"),u.style.position="fixed",u.style.left=`${h.left}px`,u.style.top=`${h.top}px`,u.style.width=`${h.width}px`,u.style.height=`${h.height}px`,u.style.margin="0",u.style.zIndex="3000",u.style.opacity="1",document.body.appendChild(u),l.style.visibility="hidden",setTimeout(()=>{u.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",u.style.left=`${c.left+c.width/2-30}px`,u.style.top=`${c.top+c.height/2-40}px`,u.style.transform="scale(0.3) rotate(360deg)",u.style.opacity="0",setTimeout(()=>{n.classList.add("absorbing"),setTimeout(()=>n.classList.remove("absorbing"),300)},400),setTimeout(()=>{u.remove(),r++,r===a&&s()},500)},d*80)}})})}function xe(){return new Promise(e=>{const i=m.playerCards().querySelectorAll(".card");if(i.length===0){e();return}let o=0;i.forEach((n,c)=>{setTimeout(()=>{n.classList.add("burning"),Me(n),o++,o===i.length&&setTimeout(e,800)},c*100)})})}function Me(e){const s=e.getBoundingClientRect();for(let i=0;i<8;i++){const o=document.createElement("div");o.className="ash-particle",o.style.position="fixed",o.style.left=`${s.left+Math.random()*s.width}px`,o.style.top=`${s.top+s.height/2+Math.random()*20}px`,o.style.animationDelay=`${Math.random()*.3}s`,document.body.appendChild(o),setTimeout(()=>o.remove(),1e3)}}function q(e){e.onApply&&e.onApply(t),t.passives.push(e)}function X(e){const s=t.passives.find(i=>i.id===e);return s&&s.onRemove&&s.onRemove(t),t.passives=t.passives.filter(i=>i.id!==e),s}function M(e=!1){if(e){const s=y.loadGameState(C,k,x);s&&(t.round=s.round,t.deck=s.deck,t.hand=s.hand,t.discardPile=s.discardPile,t.deckSize=s.deckSize,t.passives=s.passives,t.currentGimmick=s.currentGimmick,t.currentBoss=s.currentBoss,t.consecutiveWins=s.consecutiveWins,t.lastWinColors=s.lastWinColors,t.passives.forEach(i=>{i.onApply&&i.onApply(t)}))}else t.reset(),y.clearGameState();b.playBGM("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"),J()}function J(){const e=ae();if(!e.canContinue){O(!1,e.reason,M);return}const s=String(t.round),i=te.rounds[s];if(i?.boss){const o=i.boss[Math.floor(Math.random()*i.boss.length)];if(x[o]){t.currentBoss=x[o],t.currentGimmick=null,N(`âš”ï¸ ë³´ìŠ¤ ë“±ì¥: ${x[o].name}!`,"gimmick"),document.body.style.background=x[o].bgColor,w(i);return}}else t.currentBoss=null,document.body.style.background="";if(i?.gimmicks){const o=i.gimmicks[Math.floor(Math.random()*i.gimmicks.length)];o==="CLEAR"?(t.currentGimmick=null,w(i)):k[o]?(t.currentGimmick=k[o],ke(t.currentGimmick,()=>{w(i)})):w(i)}else w(i)}function w(e){if(e?.passives&&e.passives.length>0){const s=e.passives,i=t.passives.map(n=>n.id),o=s.filter(n=>C[n]&&!i.includes(n)).map(n=>C[n]);if(o.length>0){const n=$(o).slice(0,2);Ie(n,()=>{P()})}else P()}else P()}function P(){t.phase="battle",t.hand=ne(),t.enemyCards=ie();const e=t.enemyCards.length;t.playerCards=new Array(e).fill(null),t.selectedHandIndices=[],F(),W(),de(),ue(K),me($e),S(),V(),m.actionBtn().onclick=Be}function $e(e){const s=t.hand[e];if(s){if(t.selectedHandIndices.includes(e))U(s,e);else{const i=t.playerCards.findIndex(o=>o===null);i!==-1&&(t.selectedHandIndices.push(e),t.playerCards[i]=s)}Y()}}function K(e){const s=t.hand.findIndex(o=>o&&o.id===e);if(s===-1)return;const i=t.hand[s];U(i,s),Y()}function U(e,s){const i=t.playerCards.findIndex(o=>o&&o.id===e.id);i!==-1&&(t.playerCards[i]=null),t.selectedHandIndices=t.selectedHandIndices.filter(o=>o!==s)}function Y(){he(),Le(),V()}function Le(){m.playerCards().querySelectorAll(".card").forEach(s=>{s.dataset.bound||(s.dataset.bound="true",s.addEventListener("click",()=>K(s.dataset.id)))})}async function Be(){const e=[...t.selectedHandIndices],s=t.currentGimmick,i=s&&s.reversedDiscard;i?await we(e):await Ce(e);const o=oe(),n={joker:"ğŸƒ ì¡°ì»¤ ë°œë™!",redMatch:"ğŸ”´ ë¶‰ì€ ì‹¬íŒ ë°œë™!",blueMatch:"ğŸ”µ í‘¸ë¥¸ ì‹¬íŒ ë°œë™!",thirdReverse:"ğŸ”„ ì—­ì „ì˜ ìš©ì‚¬ ë°œë™!",redRush:"ğŸ ë¹¨ê°„ ë§› +1!"};o.triggeredPassives?.forEach((c,r)=>{setTimeout(()=>{n[c]&&N(n[c],"passive")},r*300)}),pe(o,async()=>{if(o.isVictory){i?await xe():await Se();const c=re(o);c>0?Te(c):Z()}else y.updateStatsOnGameOver(t.round,!1),y.clearGameState(),O(!1,`${t.round}ë¼ìš´ë“œì—ì„œ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.`,M)})}function Te(e){t.phase="acquire";const s=t.deckSize,i=t.deck.length,o=Math.max(0,s-i),n=Math.min(e,o);if(n<=0){R();return}if(n<=4){const c=z(n*2);_(c,n,r=>{t.deck.push(...r),t.deck=$(t.deck),R()})}else Q(n)}function Q(e){if(e<=0){R();return}const s=Math.min(4,e),i=z(8);_(i,s,o=>{t.deck.push(...o),t.deck=$(t.deck),Q(e-s)})}function R(){y.saveGameState(t),Z()}function Ee(e,s){const i=()=>{ve(e,o=>{o?t.passives.length>=3?ye(t.passives,o,n=>{X(n),q(o),S(),s()},()=>{i()}):(q(o),S(),s()):s()})};i()}function Ie(e,s){t.phase="event",Ee(e,s)}function Z(){if(t.round++,t.round>50){y.updateStatsOnGameOver(t.round,!0),y.clearGameState(),O(!0,"50ë¼ìš´ë“œë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!",M);return}y.saveGameState(t),J()}document.addEventListener("DOMContentLoaded",()=>{if(y.hasSave()){const e=confirm("ì €ì¥ëœ ê²Œì„ì„ ì´ì–´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");M(e)}else M();m.deckViewBtn().addEventListener("click",()=>{b.playSFX("cardSelect"),D()}),m.bgmToggleBtn().addEventListener("click",()=>{const e=b.toggleMute();m.bgmToggleBtn().textContent=e?"ğŸ”‡":"ğŸ”Š"}),m.deckCloseBtn().addEventListener("click",()=>{b.playSFX("cardSelect"),j()}),m.acquireDeckBtn().addEventListener("click",D),m.deckOverlay().addEventListener("click",e=>{e.target===m.deckOverlay()&&j()})});window.cheat={state:t,passives:C,gimmicks:k,setGimmick(e){k[e]?(t.currentGimmick=k[e],W(),console.log(`âœ… ê¸°ë¯¹ ì„¤ì •: ${k[e].name}`)):console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ë¯¹:",Object.keys(k).join(", "))},addPassive(e){if(C[e]){if(t.passives.length>=3){console.log("âš ï¸ íŒ¨ì‹œë¸Œê°€ ì´ë¯¸ 3ê°œì…ë‹ˆë‹¤. ë¨¼ì € removePassiveë¡œ ì œê±°í•˜ì„¸ìš”.");return}const s=C[e];q(s),S(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì¶”ê°€: ${s.name}`)}else console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ì‹œë¸Œ:",Object.keys(C).join(", "))},removePassive(e){const s=X(e);s?(S(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì œê±°: ${s.name}`)):console.log("âŒ í˜„ì¬ íŒ¨ì‹œë¸Œ:",t.passives.map(i=>i.id).join(", "))},clearPassives(){t.passives.forEach(e=>{e.onRemove&&e.onRemove(t)}),t.passives=[],S(),console.log("âœ… ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°ë¨")},setRound(e){t.round=e,F(),console.log(`âœ… ë¼ìš´ë“œ ì„¤ì •: ${e}`)},help(){console.log(`
ğŸ® ì¹˜íŠ¸ ëª…ë ¹ì–´ ëª©ë¡:

ğŸ“‹ ìƒíƒœ ë³´ê¸°:
  cheat.state              - í˜„ì¬ ê²Œì„ ìƒíƒœ
  cheat.passives           - ëª¨ë“  íŒ¨ì‹œë¸Œ ëª©ë¡
  cheat.gimmicks           - ëª¨ë“  ê¸°ë¯¹ ëª©ë¡

âš¡ ê¸°ë¯¹ ì„¤ì •:
  cheat.setGimmick('reversal')    - ì—­ì „ì˜ ëŒ€ê°€ ê¸°ë¯¹ ì ìš©

ğŸ”® íŒ¨ì‹œë¸Œ ê´€ë¦¬:
  cheat.addPassive('bigHand')     - í° ì† íŒ¨ì‹œë¸Œ ì¶”ê°€
  cheat.removePassive('bigHand')  - í° ì† íŒ¨ì‹œë¸Œ ì œê±°
  cheat.clearPassives()           - ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°

ğŸ”¢ ë¼ìš´ë“œ:
  cheat.setRound(10)              - 10ë¼ìš´ë“œë¡œ ì„¤ì •

ğŸ“¦ ì‚¬ìš© ê°€ëŠ¥í•œ ID:
  ê¸°ë¯¹: ${Object.keys(k).join(", ")}
  íŒ¨ì‹œë¸Œ: ${Object.keys(C).join(", ")}
    `)}};console.log("ğŸ® ì¹˜íŠ¸ ì‚¬ìš©ë²•: cheat.help()");
