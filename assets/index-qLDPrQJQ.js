(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=i(t);fetch(t.href,r)}})();function F(){const e=["blue","yellow","orange","purple","white"],s=["rock","paper","scissors"],i=[];for(const o of e)for(const t of s)i.push({color:o,shape:t,id:`${o}-${t}-${Date.now()}-${Math.random()}`});return k(i)}function k(e){const s=[...e];for(let i=s.length-1;i>0;i--){const o=Math.floor(Math.random()*(i+1));[s[i],s[o]]=[s[o],s[i]]}return s}const n={round:1,deck:[],hand:[],discardPile:[],passives:[],currentGimmick:null,deckSize:15,enemyCards:[],playerCards:[],selectedHandIndices:[],lostCardsThisRound:0,consecutiveWins:0,lastWinColors:[],phase:"battle",reset(){this.round=1,this.deck=F(),this.hand=[],this.discardPile=[],this.passives=[],this.currentGimmick=null,this.deckSize=15,this.enemyCards=[],this.playerCards=[],this.selectedHandIndices=[],this.lostCardsThisRound=0,this.consecutiveWins=0,this.lastWinColors=[],this.phase="battle"}},g={redMatch:{id:"redMatch",name:"ë¶‰ì€ ì‹¬íŒ",icon:"ğŸ”´",desc:"ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#e74c3c"},blueMatch:{id:"blueMatch",name:"í‘¸ë¥¸ ì‹¬íŒ",icon:"ğŸ”µ",desc:"íŒŒë€ìƒ‰ ì¹´ë“œëŠ” ê°™ì€ ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#3498db"},thirdReverse:{id:"thirdReverse",name:"ì—­ì „ì˜ ìš©ì‚¬",icon:"ğŸ”„",desc:"ì„¸ ë²ˆì§¸ ì¹´ë“œëŠ” ì§€ëŠ” ëª¨ì–‘ì¼ ë•Œ ìŠ¹ë¦¬í•©ë‹ˆë‹¤",color:"#9b59b6"},redRush:{id:"redRush",name:"ë¹¨ê°„ ë§›",icon:"ğŸ",desc:"í•„ë“œì— ë¹¨ê°„ìƒ‰ ì¹´ë“œê°€ 3ì¥ ì´ìƒì´ë©´ ìŠ¹ì  +1",color:"#c0392b"},flexibility:{id:"flexibility",name:"ìœ ì—°í•¨",icon:"ğŸŒŠ",desc:"ë³´ë¡œ ì´ê¸°ë©´ ë²„ë ¤ì§„ ì¹´ë“œ 1ì¥ ë³µêµ¬",color:"#2980b9"},recycle:{id:"recycle",name:"ì¬í™œìš©",icon:"â™»ï¸",desc:"ë²„ë ¤ì§ˆ í°ìƒ‰ ì¹´ë“œ 1ì¥ì€ ë±ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤",color:"#95a5a6"},joker:{id:"joker",name:"ì¡°ì»¤",icon:"ğŸƒ",desc:"ë³´ë¼ìƒ‰ ì¹´ë“œëŠ” ë¬´ì¡°ê±´ ìŠ¹ë¦¬ (ëª¨ì–‘ ë¬´ì‹œ)",color:"#8e44ad"},bigHand:{id:"bigHand",name:"í° ì†",icon:"ğŸ–ï¸",desc:"í•¸ë“œ í¬ê¸°ê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤ (6ì¥)",color:"#27ae60",handSizeBonus:1},smallDeck:{id:"smallDeck",name:"ì••ì¶•",icon:"ğŸ“¦",desc:"ë± í¬ê¸°ê°€ 1 ê°ì†Œí•©ë‹ˆë‹¤",color:"#e67e22",deckSizeBonus:-1}},v={fourCards:{id:"fourCards",name:"4ì—°íƒ€",desc:"ì ì´ íŒ¨ë¥¼ 4ê°œ ëƒ…ë‹ˆë‹¤",enemyCardCount:4},twoCards:{id:"twoCards",name:"ê°€ë²¼ìš´ ì „íˆ¬",desc:"ì ì´ íŒ¨ë¥¼ 2ê°œë§Œ ëƒ…ë‹ˆë‹¤",enemyCardCount:2},greenOnly:{id:"greenOnly",name:"ì´ˆë¡ ì „ì—¼ë³‘",desc:"ì ì´ ì´ˆë¡ìƒ‰ íŒ¨ë§Œ ëƒ…ë‹ˆë‹¤",enemyColor:"green"},scissorsOnly:{id:"scissorsOnly",name:"ê°€ìœ„ ë°”ëŒ",desc:"ì ì´ ê°€ìœ„ë§Œ ëƒ…ë‹ˆë‹¤",enemyShape:"scissors"},fog:{id:"fog",name:"ì•ˆê°œ",desc:"ì ì˜ ê°€ìš´ë° íŒ¨ê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤",hiddenIndex:1},mimic:{id:"mimic",name:"ëª¨ë°©",desc:"ì ì˜ ì²« ë²ˆì§¸ íŒ¨ê°€ ë‹¹ì‹ ì˜ ì„ íƒì„ ë”°ë¼í•©ë‹ˆë‹¤",mimicFirst:!0},corrosion:{id:"corrosion",name:"ë¶€ì‹",desc:"ì´ë²ˆ ë¼ìš´ë“œ, ë°”ìœ„ëŠ” ê°€ìœ„ì—ê²Œ ì§‘ë‹ˆë‹¤",rockLosesToScissors:!0},overload:{id:"overload",name:"í­ì£¼",desc:"ì ì´ íŒ¨ë¥¼ 5ê°œ ëƒ…ë‹ˆë‹¤! (í•¸ë“œ ì „ë¶€ ì‚¬ìš©)",enemyCardCount:5},reversal:{id:"reversal",name:"ì—­ì „ì˜ ëŒ€ê°€",desc:"í•¸ë“œ ì¹´ë“œëŠ” ë±ìœ¼ë¡œ, í•„ë“œ ì¹´ë“œëŠ” ì†Œë©¸í•©ë‹ˆë‹¤",reversedDiscard:!0}};function W(e=2,s=[]){const i=Object.values(g).filter(o=>!s.includes(o.id));return k(i).slice(0,e)}function V(){const e=Object.values(v);return e[Math.floor(Math.random()*e.length)]}const x={rock:"âœŠ",paper:"âœ‹",scissors:"âœŒï¸"};function U(){const e=n.currentGimmick;let s=3;e&&e.enemyCardCount&&(s=e.enemyCardCount);const i=["rock","paper","scissors"],o=["blue","yellow","orange","purple","white","green"],t=[];for(let r=0;r<s;r++){let a=i[Math.floor(Math.random()*i.length)],c=o[Math.floor(Math.random()*o.length)];e&&e.enemyShape&&(a=e.enemyShape),e&&e.enemyColor&&(c=e.enemyColor);const u=e&&e.hiddenIndex===r;t.push({color:c,shape:a,id:`enemy-${r}-${Date.now()}`,hidden:u})}return t}function K(){const e=n.deck;if(e.length===0)return[];const s=n.passives.reduce((u,m)=>u+(m.deckSizeBonus||0),0),i=n.deckSize+s,o=n.passives.reduce((u,m)=>u+(m.handSizeBonus||0),0),t=e.length,r=5+o,a=Math.min(Math.max(r,i-(t-r)),t,r);return e.splice(0,a)}function S(e,s){return e===s?0:e==="rock"&&s==="scissors"||e==="paper"&&s==="rock"||e==="scissors"&&s==="paper"?1:-1}function _(e,s,i,o){const t=n.passives,r=n.currentGimmick;if(t.some(c=>c.id==="joker")&&e.color==="purple")return{result:1,reason:"ì¡°ì»¤ ë°œë™!"};if(r&&r.rockLosesToScissors&&e.shape==="rock"&&s.shape==="scissors")return{result:-1,reason:"ë¶€ì‹! ë°”ìœ„ê°€ ë¬´ë ¥í™”ë¨"};if(e.shape===s.shape){if(t.some(c=>c.id==="redMatch")&&e.color==="orange")return{result:1,reason:"ë¶‰ì€ ì‹¬íŒ!"};if(t.some(c=>c.id==="blueMatch")&&e.color==="blue")return{result:1,reason:"í‘¸ë¥¸ ì‹¬íŒ!"}}return t.some(c=>c.id==="thirdReverse")&&i===2&&S(e.shape,s.shape)===-1?{result:1,reason:"ì—­ì „!"}:{result:S(e.shape,s.shape),reason:null}}function J(){const e=n.playerCards,s=n.enemyCards,i=n.currentGimmick;i&&i.mimicFirst&&e.length>0&&(s[0]={...s[0],shape:e[0].shape,mimicked:!0});let o=0,t=0,r=0;const a=[];for(let d=0;d<s.length;d++){const p=e[d],y=s[d];if(!p){a.push({result:-1,reason:"ì¹´ë“œ ì—†ìŒ"}),t++;continue}const b=_(p,y,d,s.length);a.push(b),b.result===1?o++:b.result===-1?t++:r++}const c=n.passives;let u=0;c.some(d=>d.id==="redRush")&&e.filter(p=>p.color==="orange").length>=3&&(u=1);const m=o+u,f=m>t;return{results:a,wins:o,losses:t,draws:r,bonusWins:u,totalWins:m,isVictory:f}}function Q(e){const s=n.passives,i=n.currentGimmick,o=i&&i.reversedDiscard,t=n.hand.filter((a,c)=>!n.selectedHandIndices.includes(c));let r=0;if(o){let a=[...n.playerCards.filter(c=>c!==null)];if(s.some(c=>c.id==="recycle")){const c=a.findIndex(u=>u.color==="white");if(c!==-1){const u=a.splice(c,1)[0];n.deck.push(u)}}n.deck.push(...t),n.discardPile.push(...a),r=a.length}else{let a=[...t];if(s.some(c=>c.id==="recycle")){const c=a.findIndex(u=>u.color==="white");if(c!==-1){const u=a.splice(c,1)[0];n.deck.push(u)}}n.discardPile.push(...a),r=a.length,n.deck.push(...n.playerCards.filter(c=>c!==null))}if(n.deck=k(n.deck),n.hand=[],s.some(a=>a.id==="flexibility")){for(let a=0;a<e.results.length;a++)if(e.results[a].result===1&&n.playerCards[a]?.shape==="paper"){if(n.discardPile.length>0){const c=n.discardPile.pop();n.deck.push(c)}break}}return n.lostCardsThisRound=r,n.playerCards=[],n.selectedHandIndices=[],r}function P(e){const s=["blue","yellow","orange","purple","white"],i=["rock","paper","scissors"],o=[];for(let t=0;t<e;t++){const r=s[Math.floor(Math.random()*s.length)],a=i[Math.floor(Math.random()*i.length)];o.push({color:r,shape:a,id:`acq-${t}-${Date.now()}-${Math.random()}`})}return o}function X(){const e=n.deck.length;return e<5?{canContinue:!1,reason:`ë±ì— ì¹´ë“œê°€ ${e}ì¥ë°–ì— ë‚¨ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!`}:{canContinue:!0}}const h=e=>document.querySelector(e),l={roundNum:()=>h("#round-num"),deckCount:()=>h("#deck-count"),gimmickDisplay:()=>h("#gimmick-display"),gimmickText:()=>h("#gimmick-text"),enemyCards:()=>h("#enemy-cards"),playerCards:()=>h("#player-cards"),handCards:()=>h("#hand-cards"),actionBtn:()=>h("#action-btn"),passiveList:()=>h("#passive-list"),battleResult:()=>h("#battle-result"),resultText:()=>h("#result-text"),acquireModal:()=>h("#acquire-modal"),acquireInfo:()=>h("#acquire-info"),acquireCards:()=>h("#acquire-cards"),acquireBtn:()=>h("#acquire-btn"),eventModal:()=>h("#event-modal"),eventPassives:()=>h("#event-passives"),eventSkipBtn:()=>h("#event-skip-btn"),gameoverModal:()=>h("#gameover-modal"),gameoverTitle:()=>h("#gameover-title"),gameoverText:()=>h("#gameover-text"),restartBtn:()=>h("#restart-btn"),gimmickModal:()=>h("#gimmick-modal"),gimmickAnnounceText:()=>h("#gimmick-announce-text"),gimmickOkBtn:()=>h("#gimmick-ok-btn"),deckViewBtn:()=>h("#deck-view-btn"),deckOverlay:()=>h("#deck-overlay"),deckTotalCount:()=>h("#deck-total-count"),deckCardList:()=>h("#deck-card-list"),deckCloseBtn:()=>h("#deck-close-btn"),statRock:()=>h("#stat-rock"),statPaper:()=>h("#stat-paper"),statScissors:()=>h("#stat-scissors"),acquireDeckBtn:()=>h("#acquire-deck-btn")};function q(){l.roundNum().textContent=n.round;const e=n.deck.length+n.hand.length;l.deckCount().textContent=e}function H(){const e=l.gimmickDisplay(),s=l.gimmickText();n.currentGimmick?(e.classList.remove("hidden"),s.textContent=n.currentGimmick.desc):e.classList.add("hidden")}function $(e,s={}){const{isEnemy:i=!1,isPlaced:o=!1,isSelected:t=!1,showResult:r=!1,result:a=null,index:c=-1,slotNumber:u=null}=s,m=["card",e.color];i&&m.push("enemy-card"),o&&m.push("placed"),t&&m.push("selected"),e.hidden&&m.push("hidden-card");let f="";r&&a!==null&&(f=`<div class="result-badge ${a===1?"win":a===-1?"lose":"draw"}">${a===1?"âœ“":a===-1?"âœ—":"âˆ’"}</div>`);let d="";u!==null&&(d=`<div class="slot-badge">${u}</div>`);const p=e.hidden?"?":x[e.shape];return`
    <div class="${m.join(" ")}" data-id="${e.id}" data-index="${c}">
      <span class="shape">${p}</span>
      ${f}
      ${d}
    </div>
  `}function Y(){const e=l.enemyCards();e.innerHTML=n.enemyCards.map((s,i)=>$(s,{isEnemy:!0,index:i})).join("")}function Z(e){const s=l.playerCards(),i=n.enemyCards.length;let o="";for(let t=0;t<i;t++){const r=n.playerCards[t];r?o+=$(r,{isPlaced:!0,index:t}):o+=`<div class="card-slot">${t+1}</div>`}s.innerHTML=o,e&&s.querySelectorAll(".card").forEach(t=>{const r=t.dataset.id;t.addEventListener("click",()=>e(r))})}function ee(e){const s=l.handCards();s.innerHTML=n.hand.map((i,o)=>{const t=n.selectedHandIndices.includes(o);let r=null;if(t){const a=n.playerCards.findIndex(c=>c&&c.id===i.id);a!==-1&&(r=a+1)}return $(i,{isSelected:t,index:o,slotNumber:r})}).join(""),s.querySelectorAll(".card").forEach((i,o)=>{i.addEventListener("click",()=>e(o))})}function se(){const e=l.handCards(),s=l.playerCards();e.querySelectorAll(".card").forEach((t,r)=>{const a=n.selectedHandIndices.includes(r);a?t.classList.add("selected"):t.classList.remove("selected");let c=t.querySelector(".slot-badge");if(a){const m=n.playerCards.findIndex(f=>f&&f.id===n.hand[r].id)+1;if(c)c.textContent=m;else{const f=document.createElement("div");f.className="slot-badge",f.textContent=m,t.appendChild(f)}}else c&&c.remove()}),s.querySelectorAll(".card-slot, .card").forEach((t,r)=>{const a=n.playerCards[r];if(a){if(t.classList.contains("card-slot")){const c=document.createElement("div");c.className=`card ${a.color} placed`,c.dataset.id=a.id,c.innerHTML=`<span class="shape">${x[a.shape]}</span>`,t.replaceWith(c)}}else if(!t.classList.contains("card-slot")){const c=document.createElement("div");c.className="card-slot",c.innerHTML='<span class="slot-num">'+(r+1)+"</span>",t.replaceWith(c)}})}function O(){const e=l.actionBtn(),s=n.enemyCards.length,i=n.playerCards.filter(o=>o!==null).length;i===s?(e.disabled=!1,e.textContent="ì œì¶œí•˜ê¸°!"):(e.disabled=!0,e.textContent=`ì¹´ë“œ ì„ íƒ (${i}/${s})`)}function C(){const e=l.passiveList();if(n.passives.length===0){e.innerHTML='<span style="color: var(--text-secondary); font-size: 12px;">íŒ¨ì‹œë¸Œ ì—†ìŒ</span>';return}e.innerHTML=n.passives.map(s=>`
    <div class="passive-emblem" style="background: ${s.color};">
      ${s.icon}
      <div class="passive-tooltip">${s.name}: ${s.desc}</div>
    </div>
  `).join("")}function te(e,s){const i=l.battleResult(),o=l.resultText(),t=l.playerCards().querySelectorAll(".card"),r=l.enemyCards().querySelectorAll(".card");if(e.results.forEach((c,u)=>{const m=t[u],f=r[u];if(m){const d=c.result===1?"win":c.result===-1?"lose":"draw",p=c.result===1?"âœ“":c.result===-1?"âœ—":"âˆ’";m.insertAdjacentHTML("beforeend",`<div class="result-badge ${d} pop-in">${p}</div>`)}if(f){const d=c.result===1?"lose":c.result===-1?"win":"draw",p=c.result===1?"âœ—":c.result===-1?"âœ“":"âˆ’";f.insertAdjacentHTML("beforeend",`<div class="result-badge ${d} pop-in">${p}</div>`)}}),n.currentGimmick?.mimicFirst&&n.enemyCards[0]?.mimicked){const c=r[0];c&&(c.querySelector(".shape").textContent=x[n.enemyCards[0].shape])}i.classList.remove("hidden","win","lose");let a="";e.isVictory?(i.classList.add("win"),a=`ğŸ‰ ìŠ¹ë¦¬! (${e.totalWins}ìŠ¹ ${e.losses}íŒ¨)`,e.bonusWins>0&&(a+=` [ë¹¨ê°„ ë§› +${e.bonusWins}]`)):(i.classList.add("lose"),a=`ğŸ’€ íŒ¨ë°°... (${e.wins}ìŠ¹ ${e.losses}íŒ¨)`),o.textContent=a,setTimeout(()=>{i.classList.add("hidden"),s()},2e3)}function R(e,s,i){const o=l.acquireModal(),t=l.acquireInfo(),r=l.acquireCards(),a=l.acquireBtn();t.textContent=`${e.length}ì¥ ì¤‘ ${s}ì¥ì„ ì„ íƒí•˜ì„¸ìš”`;let c=[];r.innerHTML=e.map((f,d)=>$(f,{isSelected:!1,index:d})).join(""),r.querySelectorAll(".card").forEach((f,d)=>{f.addEventListener("click",()=>{c.includes(d)?(c=c.filter(p=>p!==d),f.classList.remove("selected")):c.length<s&&(c.push(d),f.classList.add("selected")),a.disabled=c.length!==s})}),a.disabled=!0,o.classList.remove("hidden");const m=()=>{a.removeEventListener("click",m),o.classList.add("hidden");const f=c.map(d=>e[d]);i(f)};a.addEventListener("click",m)}function ne(e,s){const i=l.eventModal(),o=l.eventPassives(),t=l.eventSkipBtn();let r=null;const a=()=>{o.innerHTML=e.map(u=>`
      <div class="passive-choice ${r===u.id?"selected":""}" data-id="${u.id}">
        <span class="icon">${u.icon}</span>
        <span class="name">${u.name}</span>
        <span class="desc">${u.desc}</span>
      </div>
    `).join(""),o.querySelectorAll(".passive-choice").forEach(u=>{u.addEventListener("click",()=>{r=u.dataset.id,a(),c();const m=e.find(f=>f.id===r);s(m)})})},c=()=>{i.classList.add("hidden")};t.onclick=()=>{c(),s(null)},a(),i.classList.remove("hidden")}function ie(e,s,i,o){const t=l.eventModal(),r=l.eventPassives(),a=l.eventSkipBtn();a.textContent="ì´ì „ìœ¼ë¡œ",a.style.display="",r.innerHTML=`
    <p style="margin-bottom: 16px;">êµì²´í•  íŒ¨ì‹œë¸Œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
    <p style="margin-bottom: 16px; font-size: 14px; color: var(--text-secondary);">ìƒˆ íŒ¨ì‹œë¸Œ: ${s.icon} ${s.name}</p>
    ${e.map(c=>`
      <div class="passive-choice" data-id="${c.id}">
        <span class="icon">${c.icon}</span>
        <span class="name">${c.name}</span>
        <span class="desc">${c.desc}</span>
      </div>
    `).join("")}
  `,r.querySelectorAll(".passive-choice").forEach(c=>{c.addEventListener("click",()=>{t.classList.add("hidden"),a.textContent="ê±´ë„ˆë›°ê¸°",i(c.dataset.id)})}),a.onclick=()=>{t.classList.add("hidden"),a.textContent="ê±´ë„ˆë›°ê¸°",o&&o()},t.classList.remove("hidden")}function w(e,s,i){const o=l.gameoverModal(),t=l.gameoverTitle(),r=l.gameoverText(),a=l.restartBtn();t.textContent=e?"ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤!":"ğŸ’€ ê²Œì„ ì˜¤ë²„",t.style.color=e?"var(--success)":"var(--danger)",r.textContent=s,o.classList.remove("hidden"),a.onclick=()=>{o.classList.add("hidden"),i()}}function oe(e,s){const i=l.gimmickModal(),o=l.gimmickAnnounceText(),t=l.gimmickOkBtn();o.textContent=e.desc,i.classList.remove("hidden"),t.onclick=()=>{i.classList.add("hidden"),s()}}function E(){const e=l.deckOverlay(),s=l.deckTotalCount(),i=l.deckCardList(),o=n.discardPile.map(d=>d.id),t=[...n.deck,...n.hand].filter(d=>!o.includes(d.id)),r=n.hand.map(d=>d.id);s.textContent=t.length;const a=["blue","yellow","orange","purple","white"],c=["rock","paper","scissors"];t.sort((d,p)=>{const y=a.indexOf(d.color)-a.indexOf(p.color);return y!==0?y:c.indexOf(d.shape)-c.indexOf(p.shape)}),i.innerHTML=t.map(d=>{const p=r.includes(d.id),y=["card",d.color];return p&&y.push("in-hand"),`
            <div class="${y.join(" ")}" data-id="${d.id}">
                <span class="shape">${x[d.shape]}</span>
            </div>
        `}).join("");const u=t.filter(d=>d.shape==="rock").length,m=t.filter(d=>d.shape==="paper").length,f=t.filter(d=>d.shape==="scissors").length;l.statRock().textContent=u,l.statPaper().textContent=m,l.statScissors().textContent=f,e.classList.remove("hidden")}function T(){l.deckOverlay().classList.add("hidden")}function ce(e){return new Promise(s=>{const o=l.handCards().querySelectorAll(".card");let t=0,r=0;o.forEach((a,c)=>{e.includes(c)||(r++,setTimeout(()=>{a.classList.add("burning"),ae(a),t++,t===r&&setTimeout(s,800)},c*100))}),r===0&&s()})}function ae(e){const s=e.getBoundingClientRect(),i=e.parentElement;for(let o=0;o<8;o++){const t=document.createElement("div");t.className="ash-particle",t.style.left=`${s.left-i.getBoundingClientRect().left+Math.random()*60}px`,t.style.top=`${s.top-i.getBoundingClientRect().top+40+Math.random()*20}px`,t.style.animationDelay=`${Math.random()*.3}s`,i.appendChild(t),setTimeout(()=>t.remove(),1e3)}}function re(){return new Promise(e=>{const i=l.playerCards().querySelectorAll(".card"),o=l.deckViewBtn(),t=o.getBoundingClientRect();if(i.length===0){e();return}let r=0;i.forEach((a,c)=>{const u=a.getBoundingClientRect(),m=a.cloneNode(!0);m.style.position="fixed",m.style.left=`${u.left}px`,m.style.top=`${u.top}px`,m.style.width=`${u.width}px`,m.style.height=`${u.height}px`,m.style.margin="0",m.style.zIndex="3000",document.body.appendChild(m),a.style.visibility="hidden",setTimeout(()=>{m.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",m.style.left=`${t.left+t.width/2-30}px`,m.style.top=`${t.top+t.height/2-40}px`,m.style.transform="scale(0.3) rotate(360deg)",m.style.opacity="0",setTimeout(()=>{o.classList.add("absorbing"),setTimeout(()=>o.classList.remove("absorbing"),300)},400),setTimeout(()=>{m.remove(),r++,r===i.length&&e()},500)},c*100)})})}function de(e){return new Promise(s=>{const o=l.handCards().querySelectorAll(".card"),t=l.deckViewBtn(),r=t.getBoundingClientRect();let a=0,c=0;if(o.forEach((u,m)=>{e.includes(m)||c++}),c===0){s();return}o.forEach((u,m)=>{if(!e.includes(m)){const f=u.getBoundingClientRect(),d=u.cloneNode(!0);d.classList.remove("selected"),d.style.position="fixed",d.style.left=`${f.left}px`,d.style.top=`${f.top}px`,d.style.width=`${f.width}px`,d.style.height=`${f.height}px`,d.style.margin="0",d.style.zIndex="3000",d.style.opacity="1",document.body.appendChild(d),u.style.visibility="hidden",setTimeout(()=>{d.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",d.style.left=`${r.left+r.width/2-30}px`,d.style.top=`${r.top+r.height/2-40}px`,d.style.transform="scale(0.3) rotate(360deg)",d.style.opacity="0",setTimeout(()=>{t.classList.add("absorbing"),setTimeout(()=>t.classList.remove("absorbing"),300)},400),setTimeout(()=>{d.remove(),a++,a===c&&s()},500)},m*80)}})})}function le(){return new Promise(e=>{const i=l.playerCards().querySelectorAll(".card");if(i.length===0){e();return}let o=0;i.forEach((t,r)=>{setTimeout(()=>{t.classList.add("burning"),ue(t),o++,o===i.length&&setTimeout(e,800)},r*100)})})}function ue(e){const s=e.getBoundingClientRect();for(let i=0;i<8;i++){const o=document.createElement("div");o.className="ash-particle",o.style.position="fixed",o.style.left=`${s.left+Math.random()*s.width}px`,o.style.top=`${s.top+s.height/2+Math.random()*20}px`,o.style.animationDelay=`${Math.random()*.3}s`,document.body.appendChild(o),setTimeout(()=>o.remove(),1e3)}}function L(){n.reset(),A()}function A(){const e=X();if(!e.canContinue){w(!1,e.reason,L);return}n.round>=6&&(n.round-6)%3===0?(n.currentGimmick=V(),oe(n.currentGimmick,()=>{B()})):B()}function B(){n.round>=3&&(n.round-3)%3===0?ye(()=>{I()}):I()}function I(){n.phase="battle",n.hand=K(),n.enemyCards=U();const e=n.enemyCards.length;n.playerCards=new Array(e).fill(null),n.selectedHandIndices=[],q(),H(),Y(),Z(D),ee(me),C(),O(),l.actionBtn().onclick=fe}function me(e){const s=n.hand[e];if(s){if(n.selectedHandIndices.includes(e))j(s,e);else{const i=n.playerCards.findIndex(o=>o===null);i!==-1&&(n.selectedHandIndices.push(e),n.playerCards[i]=s)}z()}}function D(e){const s=n.hand.findIndex(o=>o&&o.id===e);if(s===-1)return;const i=n.hand[s];j(i,s),z()}function j(e,s){const i=n.playerCards.findIndex(o=>o&&o.id===e.id);i!==-1&&(n.playerCards[i]=null),n.selectedHandIndices=n.selectedHandIndices.filter(o=>o!==s)}function z(){se(),he(),O()}function he(){l.playerCards().querySelectorAll(".card").forEach(s=>{s.dataset.bound||(s.dataset.bound="true",s.addEventListener("click",()=>D(s.dataset.id)))})}async function fe(){const e=[...n.selectedHandIndices],s=n.currentGimmick,i=s&&s.reversedDiscard;i?await de(e):await ce(e);const o=J();te(o,async()=>{if(o.isVictory){i?await le():await re();const t=Q(o);t>0?pe(t):N()}else w(!1,`${n.round}ë¼ìš´ë“œì—ì„œ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.`,L)})}function pe(e){n.phase="acquire";const s=n.passives.reduce((a,c)=>a+(c.deckSizeBonus||0),0),i=n.deckSize+s,o=n.deck.length,t=Math.max(0,i-o),r=Math.min(e,t);if(r<=0){M();return}if(r<=4){const a=P(r*2);R(a,r,c=>{n.deck.push(...c),n.deck=k(n.deck),M()})}else G(r)}function G(e){if(e<=0){M();return}const s=Math.min(4,e),i=P(8);R(i,s,o=>{n.deck.push(...o),n.deck=k(n.deck),G(e-s)})}function M(){N()}function ye(e){n.phase="event";const s=n.passives.map(t=>t.id),i=W(2,s),o=()=>{ne(i,t=>{t?n.passives.length>=3?ie(n.passives,t,r=>{n.passives=n.passives.filter(a=>a.id!==r),n.passives.push(t),C(),e()},()=>{o()}):(n.passives.push(t),C(),e()):e()})};o()}function N(){if(n.round++,n.round>50){w(!0,"50ë¼ìš´ë“œë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!",L);return}A()}document.addEventListener("DOMContentLoaded",()=>{L(),l.deckViewBtn().addEventListener("click",E),l.deckCloseBtn().addEventListener("click",T),l.acquireDeckBtn().addEventListener("click",E),l.deckOverlay().addEventListener("click",e=>{e.target===l.deckOverlay()&&T()})});window.cheat={state:n,passives:g,gimmicks:v,setGimmick(e){v[e]?(n.currentGimmick=v[e],H(),console.log(`âœ… ê¸°ë¯¹ ì„¤ì •: ${v[e].name}`)):console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ë¯¹:",Object.keys(v).join(", "))},addPassive(e){if(g[e]){if(n.passives.length>=3){console.log("âš ï¸ íŒ¨ì‹œë¸Œê°€ ì´ë¯¸ 3ê°œì…ë‹ˆë‹¤. ë¨¼ì € removePassiveë¡œ ì œê±°í•˜ì„¸ìš”.");return}n.passives.push(g[e]),C(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì¶”ê°€: ${g[e].name}`)}else console.log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ì‹œë¸Œ:",Object.keys(g).join(", "))},removePassive(e){const s=n.passives.findIndex(i=>i.id===e);if(s!==-1){const i=n.passives.splice(s,1)[0];C(),console.log(`âœ… íŒ¨ì‹œë¸Œ ì œê±°: ${i.name}`)}else console.log("âŒ í˜„ì¬ íŒ¨ì‹œë¸Œ:",n.passives.map(i=>i.id).join(", "))},clearPassives(){n.passives=[],C(),console.log("âœ… ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°ë¨")},setRound(e){n.round=e,q(),console.log(`âœ… ë¼ìš´ë“œ ì„¤ì •: ${e}`)},help(){console.log(`
ğŸ® ì¹˜íŠ¸ ëª…ë ¹ì–´ ëª©ë¡:

ğŸ“‹ ìƒíƒœ ë³´ê¸°:
  cheat.state              - í˜„ì¬ ê²Œì„ ìƒíƒœ
  cheat.passives           - ëª¨ë“  íŒ¨ì‹œë¸Œ ëª©ë¡
  cheat.gimmicks           - ëª¨ë“  ê¸°ë¯¹ ëª©ë¡

âš¡ ê¸°ë¯¹ ì„¤ì •:
  cheat.setGimmick('reversal')    - ì—­ì „ì˜ ëŒ€ê°€ ê¸°ë¯¹ ì ìš©

ğŸ”® íŒ¨ì‹œë¸Œ ê´€ë¦¬:
  cheat.addPassive('bigHand')     - í° ì† íŒ¨ì‹œë¸Œ ì¶”ê°€
  cheat.removePassive('bigHand')  - í° ì† íŒ¨ì‹œë¸Œ ì œê±°
  cheat.clearPassives()           - ëª¨ë“  íŒ¨ì‹œë¸Œ ì œê±°

ğŸ”¢ ë¼ìš´ë“œ:
  cheat.setRound(10)              - 10ë¼ìš´ë“œë¡œ ì„¤ì •

ğŸ“¦ ì‚¬ìš© ê°€ëŠ¥í•œ ID:
  ê¸°ë¯¹: ${Object.keys(v).join(", ")}
  íŒ¨ì‹œë¸Œ: ${Object.keys(g).join(", ")}
    `)}};console.log("ğŸ® ì¹˜íŠ¸ ì‚¬ìš©ë²•: cheat.help()");
